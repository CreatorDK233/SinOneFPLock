C51 COMPILER V9.60.0.0   APPUNLOCK                                                         04/21/2023 14:57:02 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE APPUNLOCK
OBJECT MODULE PLACED IN .\Objects\AppUnlock.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE Softwares\ModuleLogic\AppUnlock.c LARGE OMF2 OPTIMIZE(9,SPEED) BROWSE IN
                    -CDIR(.\Drivers\Lib\c;.\Drivers\Lib\H;.\Drivers\Lib\IAP_Lib;.\Drivers\Lib\TouchKey_lib;.\Drivers\Physical;.\Drivers\Proto
                    -col;.\Softwares\Application;.\Softwares\Basic;.\Softwares\ModuleLogic;.\Drivers\Protocol\YC_NFC;.\Drivers\Protocol\WIFI_
                    -Tuya) DEBUG PRINT(.\Listings\AppUnlock.lst) TABS(2) OBJECT(.\Objects\AppUnlock.obj)

line level    source

   1          #include "AppUnlock.h"
   2          #include "Project.h"
   3          #include "EEPROM.h"
   4          #include "global_variable.h"
   5          
   6          
   7          #define C2D(x) (x-0x30)
   8          #define D2C(x) (x+0x30)
   9          
  10          #define true 1
  11          #define false 0
  12          //#define NULL 0
  13          #define s_int  signed int
  14          #define u_int  unsigned int
  15          #define s_char signed char
  16          #define u_char unsigned char
  17          #define bool   unsigned char
  18          u_char version[]="sl_generic_v1.0.0.007";
  19          
  20          #define mode_serial_temp (u_char)6       //Â∫èÂàóÂè∑Ê®°ÂºèÔºåÊó†Â±èÁâà‰ΩøÁî®Ôºå1Ê¨°ÊúâÊïà‰ΩøÁî®Ê¨°Êï?
  21          #define mode_serial_count (u_char)7      //Â∫èÂàóÂè∑Ê®°ÂºèÔºåÊó†Â±èÁâà‰ΩøÁî®Ôºå‰ΩøÁî®Ê¨°Êï∞1-999Ê¨?
  22          
  23          #define USER_PWD_MAX_LEN  12
  24          #define LOCK_PWD_MAX_LEN   12
  25          #define LOCK_PWD_NOLED_MAX_LEN 13
  26          #define DEF_MAX_SERIAL_NUM   (9999)
  27          #define DEF_MAX_LIMIT_SERIAL_NUM   (11)
  28          #define DEF_MAX_COUNT_NUM (999)
  29          
  30          typedef struct _ipwd
  31          {
  32            u_char  lockpwd[LOCK_PWD_NOLED_MAX_LEN+1];  //ÂºÄÈîÅÂØÜÁ†?
  33            u_int   lockpwd_len;  //ÂºÄÈîÅÂØÜÁ†ÅÁöÑÈïøÂ∫¶
  34            u_int   iscorrect;    //ÂØÜÁ†ÅÊòØÂê¶Ê≠£Á°Æ
  35            u_char  mode;         //mode_count„ÄÅmode_temporary„Ä? mode_period„ÄÅmode_limit
  36            u_int   rand;         //ÈöèÊú∫Êï?
  37            u_int   serialnum;
  38            u_int   count;        //ËÆ°Êï∞Ê®°ÂºèÁöÑÊ¨°Êï?
  39            u_char  userpwd[USER_PWD_MAX_LEN+1];    //Áî®Êà∑ÂØÜÁ†Å
  40            u_int   userpwd_len;    //Áî®Êà∑ÂØÜÁ†ÅÁöÑÈïøÂ∫?
  41            u_int   userpwd_hash[USER_PWD_MAX_LEN+1];  //Áî®Êà∑ÂØÜÁ†ÅhashÁªìÊûú
  42            u_int   userpwd_hash_len;  //Áî®Êà∑ÂØÜÁ†ÅhashÁöÑÈïøÂ∫?
  43            u_int   userpwd_iscorrect; //ÂºÄÈîÅÂØÜÁ†Å‰∏≠ÂåÖÂê´ÁöÑÁî®Êà∑ÂØÜÁ†ÅÊòØÂê¶Ê≠£Á°?
  44            u_char  isencrypt;
  45          }ipwd;
  46          
  47          u_int code hash_user[5][100]={ //‰ΩøÁî®Â§ö‰∏™Êï∞ÁªÑÂìàÂ∏åÁî®Êà∑ÂØÜÁ†ÅÔºåÂ¶ÇÊûú‰ΩøÁî?‰∏™Êï∞ÁªÑÂØπÂ∫?-12‰ΩçÊ
             -âÄÊúâÁöÑÁî®Êà∑ÂØÜÁ†ÅÔºåÂìàÂ∏åÈáçÂ§çÁöÑÊ¶ÇÁéá‰ºöÈ´òÂæàÂ§ö
  48              //6‰ΩçÁî®Êà∑ÂØÜÁ†?
  49               {315,420,254,105,513,410,450,425,415,350,
  50                523,125,210,143,134,201,314,250,102,214,
  51                451,135,130,435,104,153,401,304,452,234,
C51 COMPILER V9.60.0.0   APPUNLOCK                                                         04/21/2023 14:57:02 PAGE 2   

  52                204,421,301,140,132,405,325,520,305,430,
  53                352,241,413,253,302,145,120,240,412,532,
  54                501,251,324,402,321,345,310,503,231,213,
  55                502,351,543,142,354,524,235,534,312,510,
  56                203,340,154,514,215,243,542,530,150,512,
  57                540,453,230,541,124,504,403,341,521,342,
  58                432,431,103,205,423,531,123,245,320,152
  59                },
  60                //7‰ΩçÁî®Êà∑ÂØÜÁ†?
  61                {206,564,653,416,632,140,521,640,520,245,
  62                634,164,126,420,603,230,124,102,506,501,
  63                512,610,136,530,106,463,513,235,523,154,
  64                326,130,320,605,145,426,310,315,461,341,
  65                264,524,641,504,150,403,526,405,563,502,
  66                253,432,406,421,650,364,561,436,265,134,
  67                430,104,301,435,431,243,625,542,142,156,
  68                615,261,160,240,306,624,162,614,654,205,
  69                143,630,623,214,541,643,510,165,324,560,
  70                152,412,532,213,356,210,645,503,602,251
  71                },
  72                //8‰ΩçÁî®Êà∑ÂØÜÁ†?
  73                {523,547,510,356,175,264,316,214,642,704,
  74                207,140,452,352,253,526,453,514,603,367,
  75                752,731,307,673,471,326,165,764,106,713,
  76                760,450,413,105,243,527,631,475,632,634,
  77                732,605,401,423,741,576,126,306,350,162,
  78                617,725,160,503,246,257,163,231,201,650,
  79                467,645,412,532,342,345,513,156,210,765,
  80                107,256,407,403,520,357,670,437,271,312,
  81                247,561,235,564,157,754,674,463,723,320,
  82                170,215,472,364,740,402,371,567,365,274
  83                },
  84                //9‰ΩçÁî®Êà∑ÂØÜÁ†?
  85                {743,503,631,628,416,286,783,247,672,364,
  86                380,612,468,712,162,346,680,857,675,807,
  87                237,316,361,142,613,736,158,837,648,351,
  88                430,352,734,128,356,543,270,815,420,825,
  89                817,718,702,415,841,678,428,624,603,170,
  90                521,106,405,873,308,601,701,526,716,750,
  91                154,516,846,164,263,617,368,487,413,568,
  92                146,876,432,561,786,472,560,417,431,510,
  93                745,507,125,806,482,378,847,637,765,706,
  94                256,845,476,570,321,326,513,238,746,763
  95                },
  96                //10-12‰ΩçÁî®Êà∑ÂØÜÁ†ÅÔºå10‰ΩçÂØÜÁ†ÅÊó∂ÔºåÈÅáÂà?ÂàôÂØπÂ∫îÁöÑÊò?0Ôº?11‰ΩçÂØÜÁ†ÅÊó∂ÔºåÈÅáÂà?ÂàôÂØπÂ∫îÁöÑÊ
             -ò?0ÔºåÈÅáÂà?ÂàôÂØπÂ∫îÁöÑÊò?1Ôº?12‰ΩçÂØÜÁ†ÅÊó∂ÔºåÈÅáÂà?ÂàôÂØπÂ∫îÁöÑÊò?0ÔºåÈÅáÂà?ÂàôÂØπÂ∫îÁöÑÊò?1ÔºåÈÅáÂà?ÂàôÂØπÂ∫îÁöÑÊò?2
  97                {174,192,210,957,720,859,178,758,958,105,
  98                346,563,419,594,892,581,208,274,791,348,
  99                520,371,735,601,951,158,752,207,825,815,
 100                860,398,980,703,840,361,628,214,436,248,
 101                218,843,571,412,906,159,962,713,201,647,
 102                970,230,841,831,894,478,902,385,580,167,
 103                190,591,874,659,189,675,764,186,359,365,
 104                148,420,940,482,590,384,736,754,871,968,
 105                370,945,435,932,410,519,870,392,469,310,
 106                694,391,386,314,983,908,376,802,297,913
 107                },
 108            };
 109          
 110          u_int code hash_6bit[100]={47915,13054,41259,18369,40178,38207,25638,46817,46083,30419,
 111                       50986,10896,36704,10563,18506,28065,50342,21086,19537,30698,
 112                       53109,37046,30852,27564,51967,47385,50612,48059,40981,31760,
C51 COMPILER V9.60.0.0   APPUNLOCK                                                         04/21/2023 14:57:02 PAGE 3   

 113                       50162,56901,46805,42069,42970,59167,52317,27980,14682,31780,
 114                       52183,53819,56328,14976,19547,57182,16280,37081,32197,36125,
 115                       13540,21659,12468,48951,40278,10829,14907,54921,29630,17634,
 116                       10298,37018,43259,24157,32765,20453,28015,31684,28345,35018,
 117                       48176,52041,47921,40917,54819,14208,25789,34708,42817,14563,
 118                       39746,20874,58164,19734,32401,10495,48375,48175,37602,21854,
 119                       48397,27564,58192,41362,56024,23704,14650,26048,47309,28619
 120          };
 121          
 122          bool pwd_prepare(ipwd *pwd,u_char userpwd[],u_int userpwdlen,u_char lockpwd[],u_int lockpwd_len);
 123          bool pwd_shiftr_d(ipwd *pwd);
 124          bool pwd_shiftl_d(ipwd *pwd);
 125          bool pwd_userpwd_select_d(ipwd *pwd,u_char userpwd[],u_int userpwdlen);
 126          bool pwd_confuse_d(ipwd *pwd);
 127          bool pwd_hash_d(ipwd *pwd);
 128          bool pwd_cross_d(ipwd *pwd);
 129          bool pwd_unpack_rd(ipwd *pwd);
 130          bool pwd_unpack(ipwd *pwd,u_char userpwd[],u_int userId,u_int userpwdlen);
 131          
 132          unsigned char pwd_decrypt(unsigned char userpwd[],unsigned int userId,unsigned int userpwdlen,unsigned cha
             -r lockpwd[],unsigned int lockpwd_len,unsigned int *pmode,unsigned int *presult);
 133          
 134          #if (0)
              void debug_start(u_char *str)
              {
              #ifdef DEBUG_GCC
                printf( " %s :",str);
                debug_singleline = true;
              #endif
              }
              
              void debug_print(u_char *re_str,...)
              {
              #ifdef DEBUG_GCC
                   char buff[512]={0};
                 char cmd[550]={0};
                 u_int y=0,m=0,d=0,h=0,s=0;
                 
                   va_list args;
                   va_start(args, re_str);
              
                   vsnprintf(buff,1024 ,re_str, args);
                   va_end(args);
              
                 printf(buff);
              
                 u_int len = strlen(buff);
                 if( buff[len-1]==0x0A )
                  buff[len-1] = 0;
                 //system_time(&y,&m,&d,&h,&s);
                // sprintf(cmd,"echo '%04d-%02d-%02d %02d:%02d  %s' >> /lxk/tj/backup/elog",y,m,d,h,s,buff);
                 system(cmd);
              #endif
              }
              
              void debug_print_array(u_char buf[],u_int _len)
              {
              #ifdef DEBUG_GCC
                if( _len==12 )
                  debug_print("buf=0x%x,0x%x,0x%x,0x%x,0x%x,0x%x,0x%x,0x%x,0x%x,0x%x,0x%x,0x%x\n",buf[0],buf[1],buf[2],buf
             -[3],buf[4],buf[5],buf[6],buf[7],buf[8],buf[9],buf[10],buf[11]);
                else if( _len==13 )
C51 COMPILER V9.60.0.0   APPUNLOCK                                                         04/21/2023 14:57:02 PAGE 4   

                  debug_print("buf=0x%x,0x%x,0x%x,0x%x,0x%x,0x%x,0x%x,0x%x,0x%x,0x%x,0x%x,0x%x,0x%x\n",buf[0],buf[1],buf[2
             -],buf[3],buf[4],buf[5],buf[6],buf[7],buf[8],buf[9],buf[10],buf[11],buf[12]);
              #endif
              }
              
              
              void debug_end()
              {
              #ifdef DEBUG_GCC
                printf( "\n");
                debug_singleline = false;
              #endif
              }
              #endif
 186          
 187          
 188          void re_memcpy(u_char dst[],u_char src[],u_int len)
 189          {
 190   1        u_int i;
 191   1        for(i=0;i<len;i++)
 192   1          dst[i] = src[i];
 193   1      }
 194          
 195          
 196          u_char dad(u_char c1,u_char c2)
 197          {
 198   1        return (u_char)((c1+c2)%10);
 199   1      }
 200          
 201          u_char dsd(u_char c1,u_char c2)
 202          {
 203   1        if( c1>=c2 )
 204   1          return (u_char)(c1-c2);
 205   1        return (u_char)(c1+10-c2);
 206   1      }
 207          bool pwd_prepare(ipwd *pwd,u_char userpwd[],u_int userpwdlen,u_char lockpwd[],u_int lockpwd_len)
 208          {
 209   1        if( pwd==NULL )
 210   1          return false;
 211   1        if( userpwdlen<6 || userpwdlen>USER_PWD_MAX_LEN|| lockpwd_len<LOCK_PWD_MAX_LEN|| lockpwd_len>LOCK_PWD_NOL
             -ED_MAX_LEN)
 212   1          return false;
 213   1        pwd->lockpwd_len = lockpwd_len;
 214   1        re_memcpy(pwd->lockpwd,lockpwd,pwd->lockpwd_len);
 215   1        pwd->lockpwd[lockpwd_len]=0;
 216   1        pwd->userpwd_len = userpwdlen;
 217   1        re_memcpy(pwd->userpwd,userpwd,pwd->userpwd_len);
 218   1        pwd->userpwd[userpwdlen]=0;
 219   1        return true;
 220   1      }
 221          
 222          bool pwd_shiftr_d(ipwd *pwd)
 223          {
 224   1        s_int i=0;
 225   1        s_int j=0;
 226   1        u_int start,end,offset;
 227   1      
 228   1        if( pwd==NULL )
 229   1          return false;
 230   1        start = 1;
 231   1        end = pwd->lockpwd_len-1;
 232   1        offset = pwd->lockpwd[0];
C51 COMPILER V9.60.0.0   APPUNLOCK                                                         04/21/2023 14:57:02 PAGE 5   

 233   1        offset = (offset%10)%(end-start+1);
 234   1        
 235   1        if( offset==0 )
 236   1          return false;
 237   1        
 238   1        for(i=0;i<offset;i++)
 239   1        {
 240   2          u_char tmp = pwd->lockpwd[end];
 241   2          for(j=(end-1);j>=0;j--)
 242   2          {
 243   3            pwd->lockpwd[j+1] = pwd->lockpwd[j];
 244   3          }
 245   2          pwd->lockpwd[start] = tmp;
 246   2        }
 247   1        return true;
 248   1      }
 249          
 250          
 251          bool pwd_shiftl_d(ipwd *pwd)
 252          {
 253   1        s_int i=0;
 254   1        s_int j=0;
 255   1        u_int start,end,offset;
 256   1      
 257   1        if( pwd==NULL )
 258   1          return false;
 259   1        start = 0;
 260   1        end = pwd->lockpwd_len-2;
 261   1        offset = pwd->lockpwd[pwd->lockpwd_len-1];
 262   1        offset = (offset%10)%(end-start+1);
 263   1      
 264   1        if( offset==0 )
 265   1          return false;
 266   1        
 267   1        for(i=0;i<offset;i++)
 268   1        {
 269   2          u_char tmp = pwd->lockpwd[start];
 270   2          for(j=(start+1);j<=end;j++)
 271   2          {
 272   3            pwd->lockpwd[j-1] = pwd->lockpwd[j];
 273   3          }
 274   2          pwd->lockpwd[end] = tmp;
 275   2        }
 276   1      
 277   1        return true;
 278   1      }
 279          
 280          bool  pwd_userpwd_safe_d(ipwd *pwd,u_char userpwd[],u_int userpwdlen)
 281          {
 282   1        if( pwd->mode==mode_serial_temp || pwd->mode==mode_serial_count )
 283   1        {
 284   2          u_int i=0,checksum=0;
 285   2          u_char h1,h2,h3,h4;
 286   2          for(i=0;i<userpwdlen;i++)
 287   2            checksum += userpwd[i];
 288   2          h1=(checksum%100)/10;
 289   2          h2=checksum%10;
 290   2          h3=userpwd[userpwdlen-1];
 291   2          h4=userpwd[userpwdlen-2];
 292   2      
 293   2          pwd->lockpwd[1] = dad(pwd->lockpwd[1],h1);
 294   2          pwd->lockpwd[2] = dad(pwd->lockpwd[2],h2);
C51 COMPILER V9.60.0.0   APPUNLOCK                                                         04/21/2023 14:57:02 PAGE 6   

 295   2          pwd->lockpwd[3] = dad(pwd->lockpwd[3],h3);
 296   2          pwd->lockpwd[4] = dad(pwd->lockpwd[4],h4);
 297   2          return true;
 298   2        }
 299   1         return false;
 300   1      }
 301          
 302          bool pwd_userpwd_select_d(ipwd *pwd,u_char userpwd[],u_int userpwdlen)
 303          {
 304   1        u_int checksum = 0,i=0;
 305   1        u_int pwdlen,_data,d1,d2,d3,d4,dc,bten;
 306   1        pwdlen = userpwdlen;
 307   1        _data = hash_user[(userpwdlen-6)%5][pwd->rand]; ////??????
 308   1        d1 = _data/100;
 309   1        d2 = (_data%100)/10;
 310   1        d3 = _data%10;
 311   1        d4 = 0;
 312   1        dc = 0;
 313   1        
 314   1        bten = userpwdlen-11;
 315   1        
 316   1        if( pwd==NULL )
 317   1          return false;
 318   1      
 319   1        if( pwd->rand<=0 || pwd->rand>=100 )
 320   1          return false;
 321   1      
 322   1        if( pwdlen<6 || pwdlen>12 )
 323   1          return false;
 324   1      
 325   1        pwd_userpwd_safe_d(pwd,userpwd,userpwdlen);
 326   1        if( bten>=0 && bten<=2 )
 327   1        {
 328   2            if( d1<=bten )
 329   2              d1 += 10;
 330   2            if( d2<=bten )
 331   2              d2 += 10;
 332   2            if( d3<=bten )
 333   2              d3 += 10;
 334   2        }
 335   1        for(i=1;i<=userpwdlen;i++){
 336   2          if( i!=d1 && i!=d2 && i!=d3 )
 337   2            {
 338   3              d4 = i;
 339   3              break;
 340   3            }
 341   2        }
 342   1        
 343   1        for(i=0;i<userpwdlen;i++)
 344   1          checksum += userpwd[i];
 345   1        if(pwd->mode==mode_serial_temp)
 346   1        {
 347   2          u_int d5 = 0;
 348   2          for(i=userpwdlen-1;i>=0;i--){
 349   3            if( i!=d1 && i!=d2 && i!=d3 && i!=d4 )
 350   3            {
 351   4              d5 = i;
 352   4              break;
 353   4            }
 354   3          }
 355   2          pwd->userpwd_hash[0] = pwd->lockpwd[1];
 356   2          pwd->userpwd_hash[1] = pwd->lockpwd[2];
C51 COMPILER V9.60.0.0   APPUNLOCK                                                         04/21/2023 14:57:02 PAGE 7   

 357   2          pwd->userpwd_hash[2] = pwd->lockpwd[3];
 358   2          pwd->userpwd_hash[3] = pwd->lockpwd[4];
 359   2          pwd->userpwd_hash[4] = pwd->lockpwd[5];
 360   2          pwd->userpwd_hash_len = 5;
 361   2          
 362   2          if( userpwd[d1]==pwd->userpwd_hash[0] && userpwd[d2]==pwd->userpwd_hash[1] && userpwd[d3]==pwd->userpwd_
             -hash[2] && userpwd[d4]==pwd->userpwd_hash[3] &&  userpwd[d5]==pwd->userpwd_hash[4] )
 363   2            pwd->userpwd_iscorrect = 1;
 364   2        }
 365   1        else if(pwd->mode==mode_serial_count)
 366   1        {
 367   2          for(i=userpwdlen-1;i>=0;i--)
 368   2          {
 369   3            if( i!=d1 && i!=d2 && i!=d3 )
 370   3            {
 371   4              d4 = i;
 372   4              break;
 373   4            }
 374   3          }
 375   2      
 376   2          pwd->userpwd_hash[0] = pwd->lockpwd[1];
 377   2          pwd->userpwd_hash[1] = pwd->lockpwd[2];
 378   2          pwd->userpwd_hash[2] = pwd->lockpwd[3];
 379   2          pwd->userpwd_hash[3] = pwd->lockpwd[4];
 380   2          pwd->userpwd_hash_len = 4;
 381   2      
 382   2      
 383   2          if( userpwd[d1]==pwd->userpwd_hash[0] && userpwd[d2]==pwd->userpwd_hash[1] && userpwd[d3]==pwd->userpwd_
             -hash[2] && userpwd[d4]==pwd->userpwd_hash[3] )
 384   2            pwd->userpwd_iscorrect = 1;
 385   2      
 386   2        }
 387   1        else
 388   1        {
 389   2          pwd->userpwd_hash_len = 0;
 390   2          pwd->userpwd_iscorrect = 0;
 391   2        }
 392   1        if( pwd->userpwd_iscorrect==1 )
 393   1          return true;
 394   1        return false;
 395   1      }
 396          
 397          bool pwd_confuse_d(ipwd *pwd)
 398          {
 399   1        s_int i=0,j=0,sum=0;
 400   1      
 401   1        if( pwd==NULL )
 402   1          return false;
 403   1        for(i=0;i<pwd->lockpwd_len-1;i++)
 404   1          sum += pwd->lockpwd[i];
 405   1        pwd->lockpwd[pwd->lockpwd_len-1] = dsd(pwd->lockpwd[pwd->lockpwd_len-1],sum%10);
 406   1        for(i=0;i<pwd->lockpwd_len;i++)
 407   1        {
 408   2          for(j=0;j<pwd->lockpwd_len;j++)
 409   2          {
 410   3            if( i!=j )
 411   3              pwd->lockpwd[j] = dad(pwd->lockpwd[i],pwd->lockpwd[j]);
 412   3          }
 413   2        }
 414   1      
 415   1        return true;
 416   1      }
C51 COMPILER V9.60.0.0   APPUNLOCK                                                         04/21/2023 14:57:02 PAGE 8   

 417          
 418          bool pwd_hash_d(ipwd *pwd)
 419          {
 420   1        u_int _data = 0;
 421   1        u_char d1,d2,d3,d4,d5,d6,i;
 422   1        d1 = (u_char)(_data/10000);
 423   1        d2 = (u_char)((_data%10000)/1000);
 424   1        d3 = (u_char)((_data%1000)/100);
 425   1        d4 = (u_char)((_data%100)/10);
 426   1        d5 = (u_char)(_data%10);
 427   1        d6 = 0;
 428   1        i=0;
 429   1        
 430   1        if( pwd==NULL )
 431   1          return false;
 432   1        _data = hash_6bit[pwd->rand];
 433   1        
 434   1        for(i=1;i<=6;i++){
 435   2          if( i!=d1 && i!=d2 && i!=d3 && i!=d4 && i!=d5 )
 436   2            {
 437   3              d6 = i;
 438   3              break;
 439   3            }
 440   2        }
 441   1        
 442   1        pwd->lockpwd[1] = dsd(pwd->lockpwd[1],d1);
 443   1        pwd->lockpwd[2] = dsd(pwd->lockpwd[2],d2);
 444   1        pwd->lockpwd[3] = dsd(pwd->lockpwd[3],d3);
 445   1        pwd->lockpwd[4] = dsd(pwd->lockpwd[4],d4);
 446   1        pwd->lockpwd[5] = dsd(pwd->lockpwd[5],d5);
 447   1        pwd->lockpwd[6] = dsd(pwd->lockpwd[6],d6);
 448   1        pwd->lockpwd[7] = dad(pwd->lockpwd[7],d5);
 449   1        pwd->lockpwd[8] = dad(pwd->lockpwd[8],d4);
 450   1        pwd->lockpwd[9] = dad(pwd->lockpwd[9],d3);
 451   1      
 452   1        return true;
 453   1      }
 454          
 455          bool pwd_cross_d(ipwd *pwd)
 456          {
 457   1        u_char chx=0;
 458   1        
 459   1        if( pwd==NULL )
 460   1          return false;
 461   1        
 462   1        chx = dad(pwd->lockpwd[0],pwd->lockpwd[1]);
 463   1        pwd->lockpwd[2] = dsd(pwd->lockpwd[2],chx);
 464   1        chx = dad(pwd->lockpwd[3],pwd->lockpwd[4]);
 465   1        pwd->lockpwd[5] = dsd(pwd->lockpwd[5],chx);
 466   1        chx = dad(pwd->lockpwd[6],pwd->lockpwd[7]);
 467   1        pwd->lockpwd[8] = dsd(pwd->lockpwd[8],chx);
 468   1        chx = dad(pwd->lockpwd[9],pwd->lockpwd[10]);
 469   1        pwd->lockpwd[11] = dsd(pwd->lockpwd[11],chx);
 470   1        return true;
 471   1      }
 472          
 473          
 474          bool pwd_unpack_rd(ipwd *pwd)
 475          {
 476   1        if( pwd==NULL )
 477   1          return false;
 478   1        pwd->mode = pwd->lockpwd[0];
C51 COMPILER V9.60.0.0   APPUNLOCK                                                         04/21/2023 14:57:02 PAGE 9   

 479   1        if( pwd->lockpwd_len==LOCK_PWD_NOLED_MAX_LEN )
 480   1          pwd->mode=mode_serial_count;
 481   1        switch(pwd->mode)
 482   1        {
 483   2          case mode_serial_temp:
 484   2            pwd->rand = pwd->lockpwd[10]*10+pwd->lockpwd[11];
 485   2          break;
 486   2          case mode_serial_count:
 487   2            pwd->rand = pwd->lockpwd[0]*10+pwd->lockpwd[12]; 
 488   2          break;
 489   2        
 490   2          default:
 491   2            return false;
 492   2            break;
 493   2            
 494   2        }
 495   1        return  true;
 496   1      }
 497          
 498          void init_BackupsManagerdata(void)
 499          {
 500   1                   //µ•¥Œ ⁄»®√‹¬Î
 501   1          EEPROM_ReadSequential(BackupsSerialNumberStartAddr,UserIdentifyResultMgr.BackupsManagerID[0].Serialnum,4
             -);
 502   1          if((UserIdentifyResultMgr.BackupsManagerID[0].Serialnum[0]==0xFF)
 503   1          ||(UserIdentifyResultMgr.BackupsManagerID[0].Serialnum[1]==0xFF)
 504   1          ||(UserIdentifyResultMgr.BackupsManagerID[0].Serialnum[2]==0xFF)
 505   1          ||(UserIdentifyResultMgr.BackupsManagerID[0].Serialnum[3]==0xFF)
 506   1          )
 507   1          {
 508   2            UserIdentifyResultMgr.BackupsManagerID[0].Serialnum[0]=0x00;
 509   2            UserIdentifyResultMgr.BackupsManagerID[0].Serialnum[1]=0x00;
 510   2            UserIdentifyResultMgr.BackupsManagerID[0].Serialnum[2]=0x00;
 511   2            UserIdentifyResultMgr.BackupsManagerID[0].Serialnum[3]=0x00;
 512   2            EEPROM_WriteSequential(BackupsSerialNumberStartAddr,UserIdentifyResultMgr.ManagerID[0].Serialnum,4);
 513   2          }
 514   1          EEPROM_ReadSequential(BackupsSerialNumberStartAddr1,UserIdentifyResultMgr.ManagerID[1].Serialnum,4);
 515   1          if((UserIdentifyResultMgr.BackupsManagerID[1].Serialnum[0]==0xFF)
 516   1          ||(UserIdentifyResultMgr.BackupsManagerID[1].Serialnum[1]==0xFF)
 517   1          ||(UserIdentifyResultMgr.BackupsManagerID[1].Serialnum[2]==0xFF)
 518   1          ||(UserIdentifyResultMgr.BackupsManagerID[1].Serialnum[3]==0xFF)
 519   1          )
 520   1          {
 521   2                  UserIdentifyResultMgr.BackupsManagerID[1].Serialnum[0]=0x00;
 522   2            UserIdentifyResultMgr.BackupsManagerID[1].Serialnum[1]=0x00;
 523   2            UserIdentifyResultMgr.BackupsManagerID[1].Serialnum[2]=0x00;
 524   2            UserIdentifyResultMgr.BackupsManagerID[1].Serialnum[3]=0x00;
 525   2            EEPROM_WriteSequential(BackupsSerialNumberStartAddr1,UserIdentifyResultMgr.BackupsManagerID[1].Serialnu
             -m,4);
 526   2          }
 527   1      
 528   1          //∂‡¥Œ ⁄»®√‹¬Î
 529   1          EEPROM_ReadSequential(BackupsCountSerialNumberStartAddr,UserIdentifyResultMgr.BackupsManagerID[0].CountS
             -erialnum,4);
 530   1      
 531   1          if((UserIdentifyResultMgr.BackupsManagerID[0].CountSerialnum[0]==0xFF)
 532   1          ||(UserIdentifyResultMgr.BackupsManagerID[0].CountSerialnum[1]==0xFF)
 533   1          ||(UserIdentifyResultMgr.BackupsManagerID[0].CountSerialnum[2]==0xFF)
 534   1          ||(UserIdentifyResultMgr.BackupsManagerID[0].CountSerialnum[3]==0xFF)
 535   1          )
 536   1          {
 537   2            UserIdentifyResultMgr.BackupsManagerID[0].CountSerialnum[0]=0x00;
C51 COMPILER V9.60.0.0   APPUNLOCK                                                         04/21/2023 14:57:02 PAGE 10  

 538   2            UserIdentifyResultMgr.BackupsManagerID[0].CountSerialnum[1]=0x00;
 539   2            UserIdentifyResultMgr.BackupsManagerID[0].CountSerialnum[2]=0x00;
 540   2            UserIdentifyResultMgr.BackupsManagerID[0].CountSerialnum[3]=0x00;
 541   2            EEPROM_WriteSequential(BackupsCountSerialNumberStartAddr,UserIdentifyResultMgr.BackupsManagerID[0].Coun
             -tSerialnum,4);
 542   2          }
 543   1          EEPROM_ReadSequential(BackupsCountSerialNumberStartAddr1,UserIdentifyResultMgr.BackupsManagerID[1].Count
             -Serialnum,4);
 544   1          if((UserIdentifyResultMgr.BackupsManagerID[1].CountSerialnum[0]==0xFF)
 545   1          ||(UserIdentifyResultMgr.BackupsManagerID[1].CountSerialnum[1]==0xFF)
 546   1          ||(UserIdentifyResultMgr.BackupsManagerID[1].CountSerialnum[2]==0xFF)
 547   1          ||(UserIdentifyResultMgr.BackupsManagerID[1].CountSerialnum[3]==0xFF)
 548   1          )
 549   1          {
 550   2            UserIdentifyResultMgr.BackupsManagerID[1].CountSerialnum[0]=0x00;
 551   2            UserIdentifyResultMgr.BackupsManagerID[1].CountSerialnum[1]=0x00;
 552   2            UserIdentifyResultMgr.BackupsManagerID[1].CountSerialnum[2]=0x00;
 553   2            UserIdentifyResultMgr.BackupsManagerID[1].CountSerialnum[3]=0x00;
 554   2            EEPROM_WriteSequential(BackupsCountSerialNumberStartAddr1,UserIdentifyResultMgr.BackupsManagerID[1].Cou
             -ntSerialnum,4);
 555   2          }
 556   1          
 557   1          EEPROM_ReadSequential(BackupsTempCountNumberStartAddr,UserIdentifyResultMgr.BackupsManagerID[0].TempCoun
             -tnum,3);
 558   1          if((UserIdentifyResultMgr.BackupsManagerID[0].TempCountnum[0]==0xFF)
 559   1          ||(UserIdentifyResultMgr.BackupsManagerID[0].TempCountnum[1]==0xFF)
 560   1          ||(UserIdentifyResultMgr.BackupsManagerID[0].TempCountnum[2]==0xFF)
 561   1          )
 562   1          {
 563   2            UserIdentifyResultMgr.BackupsManagerID[0].TempCountnum[0]=0x00;
 564   2            UserIdentifyResultMgr.BackupsManagerID[0].TempCountnum[1]=0x00;
 565   2            UserIdentifyResultMgr.BackupsManagerID[0].TempCountnum[2]=0x00;
 566   2            EEPROM_WriteSequential(BackupsTempCountNumberStartAddr,UserIdentifyResultMgr.BackupsManagerID[0].TempCo
             -untnum,3);
 567   2          }
 568   1          EEPROM_ReadSequential(BackupsTempCountNumberStartAddr1,UserIdentifyResultMgr.BackupsManagerID[1].TempCou
             -ntnum,3);
 569   1          if((UserIdentifyResultMgr.BackupsManagerID[1].TempCountnum[0]==0xFF)
 570   1          ||(UserIdentifyResultMgr.BackupsManagerID[1].TempCountnum[1]==0xFF)
 571   1          ||(UserIdentifyResultMgr.BackupsManagerID[1].TempCountnum[2]==0xFF)
 572   1          )
 573   1          {
 574   2            UserIdentifyResultMgr.BackupsManagerID[1].TempCountnum[0]= 0x00;
 575   2            UserIdentifyResultMgr.BackupsManagerID[1].TempCountnum[1]= 0x00;
 576   2            UserIdentifyResultMgr.BackupsManagerID[1].TempCountnum[2]= 0x00;
 577   2            EEPROM_WriteSequential(BackupsTempCountNumberStartAddr1,UserIdentifyResultMgr.BackupsManagerID[1].TempC
             -ountnum,3);
 578   2          }
 579   1          
 580   1          EEPROM_ReadSequential(BackupsCountRandNumberStartAddr,UserIdentifyResultMgr.BackupsManagerID[0].CountRan
             -dnum,2);
 581   1          if((UserIdentifyResultMgr.BackupsManagerID[0].CountRandnum[0]==0xFF)
 582   1          ||(UserIdentifyResultMgr.BackupsManagerID[0].CountRandnum[1]==0xFF)
 583   1          )
 584   1          {
 585   2                        EEPROM_WriteSequential(BackupsCountRandNumberStartAddr,UserIdentifyResultMgr.BackupsManag
             -erID[0].CountRandnum,2);
 586   2      
 587   2          } 
 588   1          EEPROM_ReadSequential(BackupsCountRandNumberStartAddr1,UserIdentifyResultMgr.BackupsManagerID[1].CountRa
             -ndnum,2);
 589   1          if((UserIdentifyResultMgr.BackupsManagerID[1].CountRandnum[0]==0xFF)
C51 COMPILER V9.60.0.0   APPUNLOCK                                                         04/21/2023 14:57:02 PAGE 11  

 590   1          ||(UserIdentifyResultMgr.BackupsManagerID[1].CountRandnum[1]==0xFF)
 591   1          )
 592   1          {
 593   2                        EEPROM_WriteSequential(BackupsCountRandNumberStartAddr1,UserIdentifyResultMgr.BackupsMana
             -gerID[1].CountRandnum,2);
 594   2      
 595   2          }
 596   1          EEPROM_ReadSequential(CountNumberStartAddr,UserIdentifyResultMgr.BackupsManagerID[0].Countnum,3);
 597   1          if((UserIdentifyResultMgr.BackupsManagerID[0].Countnum[0]==0xFF)
 598   1          ||(UserIdentifyResultMgr.BackupsManagerID[0].Countnum[1]==0xFF)
 599   1          ||(UserIdentifyResultMgr.BackupsManagerID[0].Countnum[2]==0xFF)
 600   1          )
 601   1          {
 602   2                  EEPROM_WriteSequential(BackupsCountNumberStartAddr,UserIdentifyResultMgr.BackupsManagerID[0].Co
             -untnum,3);  
 603   2          }
 604   1          
 605   1          EEPROM_ReadSequential(BackupsCountNumberStartAddr1,UserIdentifyResultMgr.BackupsManagerID[1].Countnum,3)
             -;
 606   1          if((UserIdentifyResultMgr.BackupsManagerID[1].Countnum[0]==0xFF)
 607   1          ||(UserIdentifyResultMgr.BackupsManagerID[1].Countnum[1]==0xFF)
 608   1          ||(UserIdentifyResultMgr.BackupsManagerID[1].Countnum[2]==0xFF)
 609   1          )
 610   1          {
 611   2                  EEPROM_WriteSequential(BackupsCountNumberStartAddr1,UserIdentifyResultMgr.BackupsManagerID[1].C
             -ountnum,3);  
 612   2          }
 613   1                   //π‹¿Ì‘±√‹¬Î±∏≥ı ºªØ
 614   1      
 615   1             EEPROM_ReadSequential(BackupsManagerPasscodeMemoryStartAddr,UserIdentifyResultMgr.BackupsManagerID[
             -0].ManagerPswUserId.PasscodeBuff,12);
 616   1          if((UserIdentifyResultMgr.BackupsManagerID[0].ManagerPswUserId.PasscodeBuff[0]==0xFF)
 617   1          ||(UserIdentifyResultMgr.BackupsManagerID[0].ManagerPswUserId.PasscodeBuff[1]==0xFF)
 618   1          ||(UserIdentifyResultMgr.BackupsManagerID[0].ManagerPswUserId.PasscodeBuff[2]==0xFF)
 619   1          ||(UserIdentifyResultMgr.BackupsManagerID[0].ManagerPswUserId.PasscodeBuff[3]==0xFF)
 620   1          ||(UserIdentifyResultMgr.BackupsManagerID[0].ManagerPswUserId.PasscodeBuff[4]==0xFF)
 621   1          ||(UserIdentifyResultMgr.BackupsManagerID[0].ManagerPswUserId.PasscodeBuff[5]==0xFF)
 622   1          ||(UserIdentifyResultMgr.BackupsManagerID[0].ManagerPswUserId.PasscodeBuff[6]==0xFF)
 623   1          ||(UserIdentifyResultMgr.BackupsManagerID[0].ManagerPswUserId.PasscodeBuff[7]==0xFF)
 624   1          ||(UserIdentifyResultMgr.BackupsManagerID[0].ManagerPswUserId.PasscodeBuff[8]==0xFF)
 625   1          ||(UserIdentifyResultMgr.BackupsManagerID[0].ManagerPswUserId.PasscodeBuff[9]==0xFF)
 626   1          ||(UserIdentifyResultMgr.BackupsManagerID[0].ManagerPswUserId.PasscodeBuff[10]==0xFF)
 627   1          ||(UserIdentifyResultMgr.BackupsManagerID[0].ManagerPswUserId.PasscodeBuff[11]==0xFF)
 628   1          )
 629   1          {
 630   2            UserIdentifyResultMgr.BackupsManagerID[0].ManagerPswUserId.PasscodeBuff[0]=0x00;
 631   2            UserIdentifyResultMgr.BackupsManagerID[0].ManagerPswUserId.PasscodeBuff[1]=0x00;
 632   2            UserIdentifyResultMgr.BackupsManagerID[0].ManagerPswUserId.PasscodeBuff[2]=0x00;
 633   2            UserIdentifyResultMgr.BackupsManagerID[0].ManagerPswUserId.PasscodeBuff[3]=0x00;
 634   2            UserIdentifyResultMgr.BackupsManagerID[0].ManagerPswUserId.PasscodeBuff[4]=0x00;
 635   2            UserIdentifyResultMgr.BackupsManagerID[0].ManagerPswUserId.PasscodeBuff[5]=0x00;
 636   2            UserIdentifyResultMgr.BackupsManagerID[0].ManagerPswUserId.PasscodeBuff[6]=0x00;
 637   2            UserIdentifyResultMgr.BackupsManagerID[0].ManagerPswUserId.PasscodeBuff[7]=0x00;
 638   2            UserIdentifyResultMgr.BackupsManagerID[0].ManagerPswUserId.PasscodeBuff[8]=0x00;
 639   2            UserIdentifyResultMgr.BackupsManagerID[0].ManagerPswUserId.PasscodeBuff[9]=0x00;
 640   2            UserIdentifyResultMgr.BackupsManagerID[0].ManagerPswUserId.PasscodeBuff[10]=0x00;
 641   2            UserIdentifyResultMgr.BackupsManagerID[0].ManagerPswUserId.PasscodeBuff[11]=0x00;
 642   2      
 643   2            EEPROM_WriteSequential(BackupsManagerPasscodeMemoryStartAddr,UserIdentifyResultMgr.BackupsManagerID[0].
             -ManagerPswUserId.PasscodeBuff,12);  
 644   2          }
 645   1      
C51 COMPILER V9.60.0.0   APPUNLOCK                                                         04/21/2023 14:57:02 PAGE 12  

 646   1                    EEPROM_ReadSequential(BackupsManagerPasscodeMemoryStartAddr1,UserIdentifyResultMgr.BackupsMa
             -nagerID[1].ManagerPswUserId.PasscodeBuff,12);
 647   1          if((UserIdentifyResultMgr.BackupsManagerID[1].ManagerPswUserId.PasscodeBuff[0]==0xFF)
 648   1          ||(UserIdentifyResultMgr.BackupsManagerID[1].ManagerPswUserId.PasscodeBuff[1]==0xFF)
 649   1          ||(UserIdentifyResultMgr.BackupsManagerID[1].ManagerPswUserId.PasscodeBuff[2]==0xFF)
 650   1          ||(UserIdentifyResultMgr.BackupsManagerID[1].ManagerPswUserId.PasscodeBuff[3]==0xFF)
 651   1          ||(UserIdentifyResultMgr.BackupsManagerID[1].ManagerPswUserId.PasscodeBuff[4]==0xFF)
 652   1          ||(UserIdentifyResultMgr.BackupsManagerID[1].ManagerPswUserId.PasscodeBuff[5]==0xFF)
 653   1          ||(UserIdentifyResultMgr.BackupsManagerID[1].ManagerPswUserId.PasscodeBuff[6]==0xFF)
 654   1          ||(UserIdentifyResultMgr.BackupsManagerID[1].ManagerPswUserId.PasscodeBuff[7]==0xFF)
 655   1          ||(UserIdentifyResultMgr.BackupsManagerID[1].ManagerPswUserId.PasscodeBuff[8]==0xFF)
 656   1          ||(UserIdentifyResultMgr.BackupsManagerID[1].ManagerPswUserId.PasscodeBuff[9]==0xFF)
 657   1          ||(UserIdentifyResultMgr.BackupsManagerID[1].ManagerPswUserId.PasscodeBuff[10]==0xFF)
 658   1          ||(UserIdentifyResultMgr.BackupsManagerID[1].ManagerPswUserId.PasscodeBuff[11]==0xFF)
 659   1          )
 660   1          {
 661   2      
 662   2            UserIdentifyResultMgr.BackupsManagerID[1].ManagerPswUserId.PasscodeBuff[0]=0x00;
 663   2            UserIdentifyResultMgr.BackupsManagerID[1].ManagerPswUserId.PasscodeBuff[1]=0x00;
 664   2            UserIdentifyResultMgr.BackupsManagerID[1].ManagerPswUserId.PasscodeBuff[2]=0x00;
 665   2            UserIdentifyResultMgr.BackupsManagerID[1].ManagerPswUserId.PasscodeBuff[3]=0x00;
 666   2            UserIdentifyResultMgr.BackupsManagerID[1].ManagerPswUserId.PasscodeBuff[4]=0x00;
 667   2            UserIdentifyResultMgr.BackupsManagerID[1].ManagerPswUserId.PasscodeBuff[5]=0x00;
 668   2            UserIdentifyResultMgr.BackupsManagerID[1].ManagerPswUserId.PasscodeBuff[6]=0x00;
 669   2            UserIdentifyResultMgr.BackupsManagerID[1].ManagerPswUserId.PasscodeBuff[7]=0x00;
 670   2            UserIdentifyResultMgr.BackupsManagerID[1].ManagerPswUserId.PasscodeBuff[8]=0x00;
 671   2            UserIdentifyResultMgr.BackupsManagerID[1].ManagerPswUserId.PasscodeBuff[9]=0x00;
 672   2            UserIdentifyResultMgr.BackupsManagerID[1].ManagerPswUserId.PasscodeBuff[10]=0x00;
 673   2            UserIdentifyResultMgr.BackupsManagerID[1].ManagerPswUserId.PasscodeBuff[11]=0x00;
 674   2      
 675   2                  EEPROM_WriteSequential(BackupsManagerPasscodeMemoryStartAddr1,UserIdentifyResultMgr.BackupsMana
             -gerID[1].ManagerPswUserId.PasscodeBuff,12); 
 676   2          }
 677   1      
 678   1             
 679   1      }
 680          
 681          void init_Managerdata(void)
 682          {
 683   1                   //µ•¥Œ ⁄»®√‹¬Î
 684   1          EEPROM_ReadSequential(SerialNumberStartAddr,UserIdentifyResultMgr.ManagerID[0].Serialnum,4);
 685   1          if((UserIdentifyResultMgr.ManagerID[0].Serialnum[0]==0xFF)
 686   1          ||(UserIdentifyResultMgr.ManagerID[0].Serialnum[1]==0xFF)
 687   1          ||(UserIdentifyResultMgr.ManagerID[0].Serialnum[2]==0xFF)
 688   1          ||(UserIdentifyResultMgr.ManagerID[0].Serialnum[3]==0xFF)
 689   1          )
 690   1          {
 691   2            UserIdentifyResultMgr.ManagerID[0].Serialnum[0]=0x00;
 692   2            UserIdentifyResultMgr.ManagerID[0].Serialnum[1]=0x00;
 693   2            UserIdentifyResultMgr.ManagerID[0].Serialnum[2]=0x00;
 694   2            UserIdentifyResultMgr.ManagerID[0].Serialnum[3]=0x00;
 695   2            EEPROM_WriteSequential(SerialNumberStartAddr,UserIdentifyResultMgr.ManagerID[0].Serialnum,4);
 696   2          }
 697   1          EEPROM_ReadSequential(SerialNumberStartAddr1,UserIdentifyResultMgr.ManagerID[1].Serialnum,4);
 698   1          if((UserIdentifyResultMgr.ManagerID[1].Serialnum[0]==0xFF)
 699   1          ||(UserIdentifyResultMgr.ManagerID[1].Serialnum[1]==0xFF)
 700   1          ||(UserIdentifyResultMgr.ManagerID[1].Serialnum[2]==0xFF)
 701   1          ||(UserIdentifyResultMgr.ManagerID[1].Serialnum[3]==0xFF)
 702   1          )
 703   1          {
 704   2                  UserIdentifyResultMgr.ManagerID[1].Serialnum[0]=0x00;
 705   2            UserIdentifyResultMgr.ManagerID[1].Serialnum[1]=0x00;
C51 COMPILER V9.60.0.0   APPUNLOCK                                                         04/21/2023 14:57:02 PAGE 13  

 706   2            UserIdentifyResultMgr.ManagerID[1].Serialnum[2]=0x00;
 707   2            UserIdentifyResultMgr.ManagerID[1].Serialnum[3]=0x00;
 708   2            EEPROM_WriteSequential(SerialNumberStartAddr1,UserIdentifyResultMgr.ManagerID[1].Serialnum,4);
 709   2          }
 710   1      
 711   1          //∂‡¥Œ ⁄»®√‹¬Î
 712   1          EEPROM_ReadSequential(CountSerialNumberStartAddr,UserIdentifyResultMgr.ManagerID[0].CountSerialnum,4);
 713   1      
 714   1          if((UserIdentifyResultMgr.ManagerID[0].CountSerialnum[0]==0xFF)
 715   1          ||(UserIdentifyResultMgr.ManagerID[0].CountSerialnum[1]==0xFF)
 716   1          ||(UserIdentifyResultMgr.ManagerID[0].CountSerialnum[2]==0xFF)
 717   1          ||(UserIdentifyResultMgr.ManagerID[0].CountSerialnum[3]==0xFF)
 718   1          )
 719   1          {
 720   2            UserIdentifyResultMgr.ManagerID[0].CountSerialnum[0]=0x00;
 721   2            UserIdentifyResultMgr.ManagerID[0].CountSerialnum[1]=0x00;
 722   2            UserIdentifyResultMgr.ManagerID[0].CountSerialnum[2]=0x00;
 723   2            UserIdentifyResultMgr.ManagerID[0].CountSerialnum[3]=0x00;
 724   2            EEPROM_WriteSequential(CountSerialNumberStartAddr,UserIdentifyResultMgr.ManagerID[0].CountSerialnum,4);
 725   2          }
 726   1          EEPROM_ReadSequential(CountSerialNumberStartAddr1,UserIdentifyResultMgr.ManagerID[1].CountSerialnum,4);
 727   1          if((UserIdentifyResultMgr.ManagerID[1].CountSerialnum[0]==0xFF)
 728   1          ||(UserIdentifyResultMgr.ManagerID[1].CountSerialnum[1]==0xFF)
 729   1          ||(UserIdentifyResultMgr.ManagerID[1].CountSerialnum[2]==0xFF)
 730   1          ||(UserIdentifyResultMgr.ManagerID[1].CountSerialnum[3]==0xFF)
 731   1          )
 732   1          {
 733   2            UserIdentifyResultMgr.ManagerID[1].CountSerialnum[0]=0x00;
 734   2            UserIdentifyResultMgr.ManagerID[1].CountSerialnum[1]=0x00;
 735   2            UserIdentifyResultMgr.ManagerID[1].CountSerialnum[2]=0x00;
 736   2            UserIdentifyResultMgr.ManagerID[1].CountSerialnum[3]=0x00;
 737   2            EEPROM_WriteSequential(CountSerialNumberStartAddr1,UserIdentifyResultMgr.ManagerID[1].CountSerialnum,4)
             -;
 738   2          }
 739   1          
 740   1          EEPROM_ReadSequential(TempCountNumberStartAddr,UserIdentifyResultMgr.ManagerID[0].TempCountnum,3);
 741   1          if((UserIdentifyResultMgr.ManagerID[0].TempCountnum[0]==0xFF)
 742   1          ||(UserIdentifyResultMgr.ManagerID[0].TempCountnum[1]==0xFF)
 743   1          ||(UserIdentifyResultMgr.ManagerID[0].TempCountnum[2]==0xFF)
 744   1          )
 745   1          {
 746   2            UserIdentifyResultMgr.ManagerID[0].TempCountnum[0]=0x00;
 747   2            UserIdentifyResultMgr.ManagerID[0].TempCountnum[1]=0x00;
 748   2            UserIdentifyResultMgr.ManagerID[0].TempCountnum[2]=0x00;
 749   2            EEPROM_WriteSequential(TempCountNumberStartAddr,UserIdentifyResultMgr.ManagerID[0].TempCountnum,3);
 750   2          }
 751   1          EEPROM_ReadSequential(TempCountNumberStartAddr1,UserIdentifyResultMgr.ManagerID[1].TempCountnum,3);
 752   1          if((UserIdentifyResultMgr.ManagerID[1].TempCountnum[0]==0xFF)
 753   1          ||(UserIdentifyResultMgr.ManagerID[1].TempCountnum[1]==0xFF)
 754   1          ||(UserIdentifyResultMgr.ManagerID[1].TempCountnum[2]==0xFF)
 755   1          )
 756   1          {
 757   2            UserIdentifyResultMgr.ManagerID[1].TempCountnum[0]= 0x00;
 758   2            UserIdentifyResultMgr.ManagerID[1].TempCountnum[1]= 0x00;
 759   2            UserIdentifyResultMgr.ManagerID[1].TempCountnum[2]= 0x00;
 760   2            EEPROM_WriteSequential(TempCountNumberStartAddr1,UserIdentifyResultMgr.ManagerID[1].TempCountnum,3);
 761   2          }
 762   1          
 763   1          EEPROM_ReadSequential(CountRandNumberStartAddr,UserIdentifyResultMgr.ManagerID[0].CountRandnum,2);
 764   1          if((UserIdentifyResultMgr.ManagerID[0].CountRandnum[0]==0xFF)
 765   1          ||(UserIdentifyResultMgr.ManagerID[0].CountRandnum[1]==0xFF)
 766   1          )
C51 COMPILER V9.60.0.0   APPUNLOCK                                                         04/21/2023 14:57:02 PAGE 14  

 767   1          {
 768   2                 UserIdentifyResultMgr.ManagerID[0].CountRandnum[0]=0x00;
 769   2            UserIdentifyResultMgr.ManagerID[0].CountRandnum[1]=0x00;
 770   2                        EEPROM_WriteSequential(CountRandNumberStartAddr,UserIdentifyResultMgr.ManagerID[0].CountR
             -andnum,2);
 771   2      
 772   2          } 
 773   1          EEPROM_ReadSequential(CountRandNumberStartAddr1,UserIdentifyResultMgr.ManagerID[1].CountRandnum,2);
 774   1          if((UserIdentifyResultMgr.ManagerID[1].CountRandnum[0]==0xFF)
 775   1          ||(UserIdentifyResultMgr.ManagerID[1].CountRandnum[1]==0xFF)
 776   1          )
 777   1          {
 778   2            UserIdentifyResultMgr.ManagerID[1].CountRandnum[0]=0x00;
 779   2            UserIdentifyResultMgr.ManagerID[1].CountRandnum[1]=0x00;
 780   2      
 781   2                        EEPROM_WriteSequential(CountRandNumberStartAddr1,UserIdentifyResultMgr.ManagerID[1].Count
             -Randnum,2);
 782   2      
 783   2          }
 784   1          EEPROM_ReadSequential(CountNumberStartAddr,UserIdentifyResultMgr.ManagerID[0].Countnum,3);
 785   1          if((UserIdentifyResultMgr.ManagerID[0].Countnum[0]==0xFF)
 786   1          ||(UserIdentifyResultMgr.ManagerID[0].Countnum[1]==0xFF)
 787   1          ||(UserIdentifyResultMgr.ManagerID[0].Countnum[2]==0xFF)
 788   1          )
 789   1          {
 790   2            UserIdentifyResultMgr.ManagerID[0].Countnum[0]=0x00;
 791   2            UserIdentifyResultMgr.ManagerID[0].Countnum[1]=0x00;
 792   2            UserIdentifyResultMgr.ManagerID[0].Countnum[2]=0x00;
 793   2                  EEPROM_WriteSequential(CountNumberStartAddr,UserIdentifyResultMgr.ManagerID[0].Countnum,3); 
 794   2          }
 795   1          
 796   1          EEPROM_ReadSequential(CountNumberStartAddr1,UserIdentifyResultMgr.ManagerID[1].Countnum,3);
 797   1          if((UserIdentifyResultMgr.ManagerID[1].Countnum[0]==0xFF)
 798   1          ||(UserIdentifyResultMgr.ManagerID[1].Countnum[1]==0xFF)
 799   1          ||(UserIdentifyResultMgr.ManagerID[1].Countnum[2]==0xFF)
 800   1          )
 801   1          {
 802   2            UserIdentifyResultMgr.ManagerID[1].Countnum[0]=0x00;
 803   2            UserIdentifyResultMgr.ManagerID[1].Countnum[1]=0x00;
 804   2            UserIdentifyResultMgr.ManagerID[1].Countnum[2]=0x00;       
 805   2                  EEPROM_WriteSequential(CountNumberStartAddr1,UserIdentifyResultMgr.ManagerID[1].Countnum,3);  
 806   2          }
 807   1                init_BackupsManagerdata();
 808   1      
 809   1      }
 810          
 811          void BackupsManagerPassword(void)
 812          {
 813   1        uint8_t i;
 814   1        //ReadPasscodeUserMemoryFromEEPROM();
 815   1        for(i=0;i<12;i++)
 816   1        {
 817   2          UserIdentifyResultMgr.BackupsManagerID[0].ManagerPswUserId.PasscodeBuff[i]=PasscodeMemoryMgr[0].Passcode
             -Buff[i];
 818   2        }
 819   1        UserIdentifyResultMgr.BackupsManagerID[0].ManagerPswUserId.UserID=PasscodeMemoryMgr[0].UserID;
 820   1        EEPROM_WriteSequential(BackupsManagerPasscodeMemoryStartAddr,UserIdentifyResultMgr.BackupsManagerID[0].Ma
             -nagerPswUserId.PasscodeBuff,12);
 821   1        EEPROM_WriteSequential(BackupsManagerPwdUserIdStartAddr,&UserIdentifyResultMgr.BackupsManagerID[0].Manage
             -rPswUserId.UserID,1);
 822   1      
 823   1        //ReadPasscodeMaster02MemoryFromEEPROM();
C51 COMPILER V9.60.0.0   APPUNLOCK                                                         04/21/2023 14:57:02 PAGE 15  

 824   1        for(i=0;i<12;i++)
 825   1        {
 826   2        UserIdentifyResultMgr.BackupsManagerID[1].ManagerPswUserId.PasscodeBuff[i]=PasscodeMemoryMgr[1].PasscodeB
             -uff[i];
 827   2        }
 828   1        UserIdentifyResultMgr.BackupsManagerID[1].ManagerPswUserId.UserID=PasscodeMemoryMgr[1].UserID;
 829   1        EEPROM_WriteSequential(BackupsManagerPasscodeMemoryStartAddr1,UserIdentifyResultMgr.BackupsManagerID[1].M
             -anagerPswUserId.PasscodeBuff,12);
 830   1        EEPROM_WriteSequential(BackupsManagerPwdUserIdStartAddr1,&UserIdentifyResultMgr.BackupsManagerID[1].Manag
             -erPswUserId.UserID,1);
 831   1      
 832   1      
 833   1      
 834   1      
 835   1      }
 836          
 837          
 838          void  RestoreFactory_Managerdata(void)
 839          {
 840   1        uint8_t i;
 841   1      
 842   1                   //µ•¥Œ ⁄»®√‹¬Î
 843   1                   
 844   1            for (i=0;i<4;i++)
 845   1            {
 846   2              UserIdentifyResultMgr.ManagerID[0].Serialnum[i]= 0xFF;
 847   2                  UserIdentifyResultMgr.ManagerID[1].Serialnum[i]= 0xFF;
 848   2              UserIdentifyResultMgr.ManagerID[0].CountSerialnum[i]= 0xFF;
 849   2              UserIdentifyResultMgr.ManagerID[1].CountSerialnum[i]= 0xFF;
 850   2      
 851   2            }
 852   1            EEPROM_WriteSequential(SerialNumberStartAddr,UserIdentifyResultMgr.ManagerID[0].Serialnum,4);
 853   1            EEPROM_WriteSequential(SerialNumberStartAddr1,UserIdentifyResultMgr.ManagerID[1].Serialnum,4);
 854   1            EEPROM_WriteSequential(CountSerialNumberStartAddr,UserIdentifyResultMgr.ManagerID[0].CountSerialnum,4);
             -      
 855   1            EEPROM_WriteSequential(CountSerialNumberStartAddr1,UserIdentifyResultMgr.ManagerID[1].CountSerialnum,4)
             -;
 856   1      
 857   1          //∂‡¥Œ ⁄»®√‹¬Î
 858   1            for (i=0;i<3;i++)
 859   1            {
 860   2              UserIdentifyResultMgr.ManagerID[0].TempCountnum[i]= 0xFF;
 861   2              UserIdentifyResultMgr.ManagerID[1].TempCountnum[i]= 0xFF;
 862   2              UserIdentifyResultMgr.ManagerID[0].Countnum[i]=0xFF;
 863   2              UserIdentifyResultMgr.ManagerID[1].Countnum[i]=0xFF;
 864   2            }
 865   1            EEPROM_WriteSequential(TempCountNumberStartAddr,UserIdentifyResultMgr.ManagerID[0].TempCountnum,3);
 866   1            EEPROM_WriteSequential(TempCountNumberStartAddr1,UserIdentifyResultMgr.ManagerID[1].TempCountnum,3);
 867   1            EEPROM_WriteSequential(CountNumberStartAddr,UserIdentifyResultMgr.ManagerID[0].Countnum,3); 
 868   1            EEPROM_WriteSequential(CountNumberStartAddr1,UserIdentifyResultMgr.ManagerID[1].Countnum,3);  
 869   1      
 870   1            for (i=0;i<2;i++)
 871   1            {
 872   2              UserIdentifyResultMgr.ManagerID[0].CountRandnum[i]= 0xFF;
 873   2              UserIdentifyResultMgr.ManagerID[1].CountRandnum[i]= 0xFF;
 874   2            }
 875   1                        EEPROM_WriteSequential(CountRandNumberStartAddr,UserIdentifyResultMgr.ManagerID[0].CountR
             -andnum,2);
 876   1                        EEPROM_WriteSequential(CountRandNumberStartAddr1,UserIdentifyResultMgr.ManagerID[1].Count
             -Randnum,2);        
 877   1                        BackupsManagerPassword();
 878   1          
C51 COMPILER V9.60.0.0   APPUNLOCK                                                         04/21/2023 14:57:02 PAGE 16  

 879   1      
 880   1      }
 881          
 882          void Write_Serialnum(ipwd *pwd,u_char mode,u_int userId)
 883          {
 884   1          if( pwd==NULL )
 885   1        return;
 886   1           if(mode==mode_serial_temp)
 887   1           {
 888   2      
 889   2          UserIdentifyResultMgr.ManagerID[userId].Serialnum[0]=pwd->lockpwd[6];
 890   2          UserIdentifyResultMgr.ManagerID[userId].Serialnum[1]=pwd->lockpwd[7];
 891   2          UserIdentifyResultMgr.ManagerID[userId].Serialnum[2]=pwd->lockpwd[8];
 892   2          UserIdentifyResultMgr.ManagerID[userId].Serialnum[3]=pwd->lockpwd[9];
 893   2          
 894   2          UserIdentifyResultMgr.BackupsManagerID[userId].Serialnum[0]= UserIdentifyResultMgr.ManagerID[userId].Ser
             -ialnum[0];
 895   2          UserIdentifyResultMgr.BackupsManagerID[userId].Serialnum[1]= UserIdentifyResultMgr.ManagerID[userId].Ser
             -ialnum[1];
 896   2          UserIdentifyResultMgr.BackupsManagerID[userId].Serialnum[2]= UserIdentifyResultMgr.ManagerID[userId].Ser
             -ialnum[2];
 897   2          UserIdentifyResultMgr.BackupsManagerID[userId].Serialnum[3]= UserIdentifyResultMgr.ManagerID[userId].Ser
             -ialnum[3];
 898   2                   
 899   2          if(userId==0)
 900   2          {
 901   3            EEPROM_WriteSequential(SerialNumberStartAddr,UserIdentifyResultMgr.ManagerID[userId].Serialnum,4);
 902   3            EEPROM_WriteSequential(BackupsSerialNumberStartAddr,UserIdentifyResultMgr.BackupsManagerID[userId].Seri
             -alnum,4);
 903   3      
 904   3          }
 905   2          else if(userId==1)
 906   2          {
 907   3            EEPROM_WriteSequential(SerialNumberStartAddr1,UserIdentifyResultMgr.ManagerID[userId].Serialnum,4);
 908   3            EEPROM_WriteSequential(BackupsSerialNumberStartAddr1,UserIdentifyResultMgr.BackupsManagerID[userId].Ser
             -ialnum,4);
 909   3      
 910   3          }
 911   2        
 912   2           }
 913   1          else if(mode==mode_serial_count)
 914   1          {
 915   2          UserIdentifyResultMgr.ManagerID[userId].CountSerialnum[0]=pwd->lockpwd[8];
 916   2          UserIdentifyResultMgr.ManagerID[userId].CountSerialnum[1]=pwd->lockpwd[9];
 917   2          UserIdentifyResultMgr.ManagerID[userId].CountSerialnum[2]=pwd->lockpwd[10];
 918   2          UserIdentifyResultMgr.ManagerID[userId].CountSerialnum[3]=pwd->lockpwd[11];
 919   2      
 920   2          UserIdentifyResultMgr.ManagerID[userId].TempCountnum[0]=pwd->lockpwd[5];
 921   2          UserIdentifyResultMgr.ManagerID[userId].TempCountnum[1]=pwd->lockpwd[6];
 922   2          UserIdentifyResultMgr.ManagerID[userId].TempCountnum[2]=pwd->lockpwd[7];
 923   2          
 924   2          UserIdentifyResultMgr.ManagerID[userId].CountRandnum[0]=pwd->lockpwd[0];
 925   2          UserIdentifyResultMgr.ManagerID[userId].CountRandnum[1]=pwd->lockpwd[12];
 926   2      
 927   2          UserIdentifyResultMgr.BackupsManagerID[userId].CountSerialnum[0]=pwd->lockpwd[8];
 928   2          UserIdentifyResultMgr.BackupsManagerID[userId].CountSerialnum[1]=pwd->lockpwd[9];
 929   2          UserIdentifyResultMgr.BackupsManagerID[userId].CountSerialnum[2]=pwd->lockpwd[10];
 930   2          UserIdentifyResultMgr.BackupsManagerID[userId].CountSerialnum[3]=pwd->lockpwd[11];
 931   2      
 932   2          UserIdentifyResultMgr.BackupsManagerID[userId].TempCountnum[0]=pwd->lockpwd[5];
 933   2          UserIdentifyResultMgr.BackupsManagerID[userId].TempCountnum[1]=pwd->lockpwd[6];
 934   2          UserIdentifyResultMgr.BackupsManagerID[userId].TempCountnum[2]=pwd->lockpwd[7];
C51 COMPILER V9.60.0.0   APPUNLOCK                                                         04/21/2023 14:57:02 PAGE 17  

 935   2          
 936   2          UserIdentifyResultMgr.BackupsManagerID[userId].CountRandnum[0]=pwd->lockpwd[0];
 937   2          UserIdentifyResultMgr.BackupsManagerID[userId].CountRandnum[1]=pwd->lockpwd[12];
 938   2      
 939   2          
 940   2          if(userId==0)
 941   2          {
 942   3            EEPROM_WriteSequential(CountSerialNumberStartAddr,UserIdentifyResultMgr.ManagerID[userId].CountSerialnu
             -m,4);
 943   3            EEPROM_WriteSequential(TempCountNumberStartAddr,UserIdentifyResultMgr.ManagerID[userId].TempCountnum,3)
             -;
 944   3            EEPROM_WriteSequential(CountRandNumberStartAddr,UserIdentifyResultMgr.ManagerID[userId].CountRandnum,2)
             -;
 945   3      
 946   3            EEPROM_WriteSequential(BackupsCountSerialNumberStartAddr,UserIdentifyResultMgr.BackupsManagerID[userId]
             -.CountSerialnum,4);
 947   3            EEPROM_WriteSequential(BackupsTempCountNumberStartAddr,UserIdentifyResultMgr.BackupsManagerID[userId].T
             -empCountnum,3);
 948   3            EEPROM_WriteSequential(BackupsCountRandNumberStartAddr,UserIdentifyResultMgr.BackupsManagerID[userId].C
             -ountRandnum,2);
 949   3          
 950   3          }
 951   2          else if(userId==1)
 952   2          {
 953   3            EEPROM_WriteSequential(CountSerialNumberStartAddr1,UserIdentifyResultMgr.ManagerID[userId].CountSerialn
             -um,4);
 954   3            EEPROM_WriteSequential(TempCountNumberStartAddr1,UserIdentifyResultMgr.ManagerID[userId].TempCountnum,3
             -);
 955   3            EEPROM_WriteSequential(CountRandNumberStartAddr1,UserIdentifyResultMgr.ManagerID[userId].CountRandnum,2
             -);
 956   3      
 957   3            EEPROM_WriteSequential(BackupsCountSerialNumberStartAddr1,UserIdentifyResultMgr.BackupsManagerID[userId
             -].CountSerialnum,4);
 958   3            EEPROM_WriteSequential(BackupsTempCountNumberStartAddr1,UserIdentifyResultMgr.BackupsManagerID[userId].
             -TempCountnum,3);
 959   3            EEPROM_WriteSequential(BackupsCountRandNumberStartAddr1,UserIdentifyResultMgr.BackupsManagerID[userId].
             -CountRandnum,2);
 960   3            
 961   3          }
 962   2      
 963   2          }
 964   1      
 965   1      
 966   1      }
 967          
 968          
 969          u_int Get_Serialnum(u_int userId)
 970          {    
 971   1           u_int temp_serial_num=0;
 972   1        if(userId==0)
 973   1        {
 974   2              EEPROM_ReadSequential(SerialNumberStartAddr,UserIdentifyResultMgr.ManagerID[userId].Serialnum,4);
 975   2        }
 976   1        else if(userId==1)
 977   1        {
 978   2          EEPROM_ReadSequential(SerialNumberStartAddr1,UserIdentifyResultMgr.ManagerID[userId].Serialnum,4);
 979   2        }
 980   1        temp_serial_num=UserIdentifyResultMgr.ManagerID[userId].Serialnum[0]*1000+UserIdentifyResultMgr.ManagerID
             -[userId].Serialnum[1]*100+UserIdentifyResultMgr.ManagerID[userId].Serialnum[2]*10+UserIdentifyResultMgr.ManagerID[userId
             -].Serialnum[3];
 981   1        return  temp_serial_num;
 982   1      }
C51 COMPILER V9.60.0.0   APPUNLOCK                                                         04/21/2023 14:57:02 PAGE 18  

 983          u_int Get_CountSerialnum(u_int userId)
 984          {    
 985   1           u_int temp_countserial_num=0;
 986   1         if(userId==0)
 987   1        {
 988   2          EEPROM_ReadSequential(CountSerialNumberStartAddr,UserIdentifyResultMgr.ManagerID[userId].CountSerialnum,
             -4);
 989   2        }
 990   1        else if(userId==1)
 991   1        {
 992   2          EEPROM_ReadSequential(CountSerialNumberStartAddr1,UserIdentifyResultMgr.ManagerID[userId].CountSerialnum
             -,4);
 993   2        }
 994   1        
 995   1      
 996   1        temp_countserial_num=UserIdentifyResultMgr.ManagerID[userId].CountSerialnum[0]*1000+UserIdentifyResultMgr
             -.ManagerID[userId].CountSerialnum[1]*100+UserIdentifyResultMgr.ManagerID[userId].CountSerialnum[2]*10+UserIdentifyResult
             -Mgr.ManagerID[userId].CountSerialnum[3];
 997   1        return  temp_countserial_num;
 998   1      }
 999           
1000          u_int Get_CountSerialnum_TempCount(u_int userId)
1001          {    
1002   1           u_int temp_countserialnum_Tempcount=0;
1003   1         if(userId==0)
1004   1        {
1005   2          EEPROM_ReadSequential(TempCountNumberStartAddr,UserIdentifyResultMgr.ManagerID[userId].TempCountnum,3);
1006   2        }
1007   1        else if(userId==1)
1008   1        {
1009   2          EEPROM_ReadSequential(TempCountNumberStartAddr1,UserIdentifyResultMgr.ManagerID[userId].TempCountnum,3);
1010   2        }
1011   1        temp_countserialnum_Tempcount=UserIdentifyResultMgr.ManagerID[userId].TempCountnum[0]*100+UserIdentifyRes
             -ultMgr.ManagerID[userId].TempCountnum[1]*10+UserIdentifyResultMgr.ManagerID[userId].TempCountnum[2];
1012   1        return  temp_countserialnum_Tempcount;
1013   1      }
1014          
1015          u_int Get_CountRandnum(u_int userId)
1016          {    
1017   1          u_int temp_countrand_num=0;
1018   1         if(userId==0)
1019   1        {
1020   2          EEPROM_ReadSequential(CountRandNumberStartAddr,UserIdentifyResultMgr.ManagerID[userId].CountRandnum,2);
1021   2        }
1022   1        else if(userId==1)
1023   1        {
1024   2          EEPROM_ReadSequential(CountRandNumberStartAddr1,UserIdentifyResultMgr.ManagerID[userId].CountRandnum,2);
1025   2        }
1026   1         
1027   1        temp_countrand_num=UserIdentifyResultMgr.ManagerID[userId].CountRandnum[0]*10+UserIdentifyResultMgr.Manag
             -erID[userId].CountRandnum[1];
1028   1        return  temp_countrand_num;
1029   1      }
1030          
1031          void Write_Count(u_int  count_num,u_int userId)
1032          {    
1033   1        UserIdentifyResultMgr.ManagerID[userId].Countnum[0]=(uint8_t)(count_num/100);
1034   1        UserIdentifyResultMgr.ManagerID[userId].Countnum[1]=(uint8_t)((count_num%100)/10);
1035   1        UserIdentifyResultMgr.ManagerID[userId].Countnum[2]=(uint8_t)((count_num%100)%10);
1036   1        
1037   1        UserIdentifyResultMgr.BackupsManagerID[userId].Countnum[0]= UserIdentifyResultMgr.ManagerID[userId].Count
             -num[0];
C51 COMPILER V9.60.0.0   APPUNLOCK                                                         04/21/2023 14:57:02 PAGE 19  

1038   1        UserIdentifyResultMgr.BackupsManagerID[userId].Countnum[1]= UserIdentifyResultMgr.ManagerID[userId].Count
             -num[1];
1039   1        UserIdentifyResultMgr.BackupsManagerID[userId].Countnum[2]= UserIdentifyResultMgr.ManagerID[userId].Count
             -num[2];
1040   1      
1041   1         if(userId==0)
1042   1        {
1043   2          EEPROM_WriteSequential(CountNumberStartAddr,UserIdentifyResultMgr.ManagerID[userId].Countnum,3);  
1044   2          EEPROM_WriteSequential(BackupsCountNumberStartAddr,UserIdentifyResultMgr.BackupsManagerID[userId].Countn
             -um,3);  
1045   2      
1046   2        }
1047   1        else if(userId==1)
1048   1        {   
1049   2          EEPROM_WriteSequential(CountNumberStartAddr1,UserIdentifyResultMgr.ManagerID[userId].Countnum,3); 
1050   2          EEPROM_WriteSequential(BackupsCountNumberStartAddr1,UserIdentifyResultMgr.BackupsManagerID[userId].Count
             -num,3);
1051   2          
1052   2        }
1053   1         
1054   1      
1055   1      }
1056          u_int Get_Count(u_int userId)
1057          {    
1058   1           u_int temp_count_num=0;
1059   1         if(userId==0)
1060   1        {
1061   2          EEPROM_ReadSequential(CountNumberStartAddr,UserIdentifyResultMgr.ManagerID[userId].Countnum,3);
1062   2        }
1063   1        else if(userId==1)
1064   1        {
1065   2          EEPROM_ReadSequential(CountNumberStartAddr1,UserIdentifyResultMgr.ManagerID[userId].Countnum,3);
1066   2        }
1067   1      
1068   1        temp_count_num=UserIdentifyResultMgr.ManagerID[userId].Countnum[0]*100+UserIdentifyResultMgr.ManagerID[us
             -erId].Countnum[1]*10+UserIdentifyResultMgr.ManagerID[userId].Countnum[2];
1069   1        return  temp_count_num;
1070   1      }
1071          
1072          bool pwd_unpack(ipwd *pwd,u_char userpwd[],u_int userId,u_int userpwdlen)
1073          {
1074   1        u_int temp_serialnum=0;
1075   1        u_int temp_countserialnum=0;
1076   1        u_int temp_countnum=0;
1077   1        u_int temp_countrandnum=0;
1078   1        u_int countserialnum_Tempcount=0;
1079   1        
1080   1        if( pwd==NULL )
1081   1          return false;
1082   1        pwd->iscorrect = 0;
1083   1        if( pwd_userpwd_select_d(pwd,userpwd,userpwdlen)==false )
1084   1          return false;
1085   1        switch(pwd->mode)
1086   1        {
1087   2          case mode_serial_temp:
1088   2            pwd->serialnum=pwd->lockpwd[6]*1000+pwd->lockpwd[7]*100+pwd->lockpwd[8]*10+pwd->lockpwd[9];
1089   2            if( pwd->userpwd_iscorrect==1 )
1090   2            {
1091   3               
1092   3                  temp_serialnum=Get_Serialnum(userId);
1093   3                  if(pwd->serialnum<(DEF_MAX_SERIAL_NUM+1))
1094   3              {
C51 COMPILER V9.60.0.0   APPUNLOCK                                                         04/21/2023 14:57:02 PAGE 20  

1095   4                        if(temp_serialnum<pwd->serialnum) 
1096   4                {
1097   5                   pwd->iscorrect = 1;
1098   5                }   
1099   4                else if((temp_serialnum==DEF_MAX_SERIAL_NUM)&&(pwd->serialnum<DEF_MAX_LIMIT_SERIAL_NUM))
1100   4                {           
1101   5                                         pwd->iscorrect = 1;
1102   5                }
1103   4                else
1104   4                {
1105   5                                         pwd->iscorrect = 0;
1106   5                }
1107   4               }
1108   3      
1109   3            }
1110   2            break;
1111   2          case mode_serial_count:
1112   2            pwd->count=pwd->lockpwd[5]*100+pwd->lockpwd[6]*10+pwd->lockpwd[7];
1113   2            pwd->serialnum=pwd->lockpwd[8]*1000+pwd->lockpwd[9]*100+pwd->lockpwd[10]*10+pwd->lockpwd[11];
1114   2            if( pwd->userpwd_iscorrect==1 )
1115   2            {
1116   3              temp_countserialnum=Get_CountSerialnum(userId);
1117   3              temp_countnum=Get_Count(userId);          
1118   3              countserialnum_Tempcount=Get_CountSerialnum_TempCount(userId);
1119   3              temp_countrandnum=Get_CountRandnum(userId); 
1120   3              if(pwd->serialnum<(DEF_MAX_SERIAL_NUM+1))
1121   3              {
1122   4                if(temp_countserialnum<DEF_MAX_SERIAL_NUM)
1123   4                {
1124   5                  if(temp_countserialnum<pwd->serialnum)
1125   5                  {
1126   6                    pwd->iscorrect = 1;  
1127   6                    temp_countnum=1;  
1128   6                    Write_Count(temp_countnum,userId);  
1129   6                  }
1130   5                  else if(temp_countserialnum==pwd->serialnum)
1131   5                  { 
1132   6                    if(countserialnum_Tempcount !=pwd->count)
1133   6                    {
1134   7                      pwd->iscorrect = 1;
1135   7                      temp_countnum=1;  
1136   7                      Write_Count(temp_countnum,userId);  
1137   7                    }
1138   6                    else
1139   6                    {
1140   7                      if(temp_countrandnum!=pwd->rand)
1141   7                      {
1142   8                        pwd->iscorrect = 1;  
1143   8                        temp_countnum=1;  
1144   8                        Write_Count(temp_countnum,userId);
1145   8                      }                     
1146   7                      if(temp_countnum<pwd->count)
1147   7                      {           
1148   8                        pwd->iscorrect = 1;
1149   8                        temp_countnum=temp_countnum+1;
1150   8                        Write_Count(temp_countnum,userId);  
1151   8                      }
1152   7      
1153   7                    }
1154   6                              
1155   6                  }
1156   5                  else
C51 COMPILER V9.60.0.0   APPUNLOCK                                                         04/21/2023 14:57:02 PAGE 21  

1157   5                  {       
1158   6                    pwd->iscorrect = 0;     
1159   6                  }
1160   5                }
1161   4                else if(temp_countserialnum==DEF_MAX_SERIAL_NUM)
1162   4                {  
1163   5      
1164   5                  if(pwd->serialnum<DEF_MAX_LIMIT_SERIAL_NUM)
1165   5                  {
1166   6                    pwd->iscorrect = 1;  
1167   6                    temp_countnum=1;  
1168   6                    Write_Count(temp_countnum,userId);
1169   6                  }
1170   5                  if(pwd->serialnum==temp_countserialnum)
1171   5                  {     
1172   6                    if(countserialnum_Tempcount !=pwd->count)
1173   6                    {
1174   7                      pwd->iscorrect = 1;  
1175   7                      temp_countnum=1;  
1176   7                      Write_Count(temp_countnum,userId);
1177   7                    }
1178   6                    else
1179   6                    {
1180   7                      if(temp_countrandnum!=pwd->rand)
1181   7                      {
1182   8                        pwd->iscorrect = 1;  
1183   8                        temp_countnum=1;  
1184   8                        Write_Count(temp_countnum,userId);
1185   8                      }
1186   7                      if(temp_countnum<pwd->count)
1187   7                      {           
1188   8                        pwd->iscorrect = 1;
1189   8                        temp_countnum=temp_countnum+1;
1190   8                        Write_Count(temp_countnum,userId);  
1191   8                      }
1192   7                    }
1193   6                        
1194   6                  }
1195   5      
1196   5      
1197   5                }
1198   4      
1199   4              }
1200   3            }
1201   2            break;
1202   2            
1203   2          default:
1204   2            pwd->iscorrect = 0;
1205   2            break;
1206   2        }
1207   1      
1208   1        if( pwd->iscorrect==1 )
1209   1          return true;
1210   1        return false;
1211   1      }
1212          
1213          
1214          #ifndef PLAT_GCC
1215          unsigned char pwd_decrypt(unsigned char userpwd[],unsigned int userId,unsigned int userpwdlen,unsigned cha
             -r lockpwd[],unsigned int lockpwd_len,unsigned int *pmode,unsigned int *presult)
1216          {
1217   1        ipwd pwd={0};
C51 COMPILER V9.60.0.0   APPUNLOCK                                                         04/21/2023 14:57:02 PAGE 22  

1218   1        u_int temp_count=0;
1219   1        if( pwd_prepare(&pwd,userpwd,userpwdlen,lockpwd,lockpwd_len)==false )
1220   1          return false;
1221   1        pwd_confuse_d(&pwd);
1222   1        pwd_cross_d(&pwd);
1223   1        pwd_shiftr_d(&pwd);
1224   1        pwd_shiftl_d(&pwd);
1225   1        if( pwd_unpack_rd(&pwd)==false)
1226   1          return false;
1227   1        pwd_hash_d(&pwd);
1228   1        pwd_unpack(&pwd,userpwd,userId,userpwdlen);
1229   1        if( pmode!=NULL && presult!=NULL )
1230   1        {
1231   2          *pmode = pwd.mode;
1232   2          if( pwd.mode==mode_serial_count)
1233   2            *presult = pwd.count;
1234   2          else
1235   2            *presult = 0;
1236   2        }
1237   1        if(pwd.mode==mode_serial_temp)
1238   1        {
1239   2          if(1== pwd.iscorrect)
1240   2          {
1241   3                 //µ•¥Œ ⁄»®√‹¬Î∫Õ∂‡¥Œ ⁄»®√‹¬Î»Áπ˚π≤”√“ª∏ˆ–Ú¡–∫≈±‰¡ø ±£¨“™∏¸–¬º∆ ˝∆˜«Â¡„°£
1242   3            //temp_count=0;
1243   3            //Write_Count(temp_count);
1244   3            Write_Serialnum(&pwd,mode_serial_temp,userId);
1245   3      
1246   3          }
1247   2      
1248   2        }
1249   1        else if(pwd.mode==mode_serial_count)
1250   1        {
1251   2          if(1== pwd.iscorrect)
1252   2          Write_Serialnum(&pwd,mode_serial_count,userId);
1253   2          temp_count=Get_Count(userId);
1254   2          if(temp_count>pwd.count)
1255   2          { 
1256   3               if(temp_count>DEF_MAX_COUNT_NUM )
1257   3               {
1258   4                           temp_count=0;
1259   4                      Write_Count(temp_count,userId);
1260   4              }
1261   3            pwd.iscorrect=0;
1262   3              }
1263   2           
1264   2        }
1265   1        return pwd.iscorrect;
1266   1      }
1267          
1268          void AppUnlockTest(void)
1269          {
1270   1        //unsigned int i=0,j=0;
1271   1        u_int mode=0,result=0;
1272   1        bool  ret = false;
1273   1          //unsigned char lockpwd[12]={1,6,7,3,7,9,9,3,7,6,3,1};
1274   1          //unsigned char userpwd[12]={3,4,5,6,4,5,3,5};  //mode =1
1275   1          //unsigned char lockpwd[12]={9,0,5,0,4,3,7,4,1,1,1,1};
1276   1          //unsigned char userpwd[12]={3,4,5,6,4,5,3,5};  //mode =1
1277   1          
1278   1          //unsigned char lockpwd[12]={8,3,5,0,9,9,3,6,0,9,6,2};
1279   1          //unsigned char userpwd[12]={3,4,5,6,4,5,3,5};  //mode =2, 4-13,10:37 
C51 COMPILER V9.60.0.0   APPUNLOCK                                                         04/21/2023 14:57:02 PAGE 23  

1280   1      
1281   1          unsigned char lockpwd[12]={2,0,2,2,9,3,6,9,0,9,5,4};
1282   1          unsigned char userpwd[12]={3,4,5,6,4,5,3,5};  //mode =3, 00:00~11:00 
1283   1        
1284   1              //userpwdÊòØÈó®ÈîÅ‰∏äËÆæÂÆöÁöÑÁÆ°ÁêÜÂëòÂØÜÁ†ÅÔº?
1285   1        ret = pwd_decrypt(userpwd,0,8,lockpwd,12,&mode,&result); //Ëß£Á†ÅÂºÄÈîÅÂØÜÁ†ÅlockpwdÔºå‰º†ÂÖ•Êï¥ÂΩ¢Êï∞ÁªÑ
             -ÁöÑÁî®Êà∑ÂØÜÁ†Å„ÄÅÁî®Êà∑ÂØÜÁ†ÅÈïøÂ∫¶„ÄÅÊï¥ÂΩ¢Êï∞ÁªÑÁöÑÂºÄÈîÅÂØÜÁ†?
1286   1      
1287   1          DEBUG_MARK;
1288   1      }
1289          #endif


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   8413    ----
   CONSTANT SIZE    =   1295    ----
   XDATA SIZE       =     22     286
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
