C51 COMPILER V9.60.0.0   RTC_PCF8563                                                       05/12/2023 14:54:15 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE RTC_PCF8563
OBJECT MODULE PLACED IN .\Objects\RTC_PCF8563.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE Drivers\Protocol\RTC_PCF8563.c LARGE OMF2 OPTIMIZE(9,SPEED) BROWSE INCDI
                    -R(.\Drivers\Lib\c;.\Drivers\Lib\H;.\Drivers\Lib\IAP_Lib;.\Drivers\Lib\TouchKey_lib;.\Drivers\Physical;.\Drivers\Protocol
                    -;.\Softwares\Application;.\Softwares\Basic;.\Softwares\ModuleLogic;.\Drivers\Protocol\YC_NFC;.\Drivers\Protocol\WIFI_Tuy
                    -a) DEBUG PRINT(.\Listings\RTC_PCF8563.lst) TABS(2) OBJECT(.\Objects\RTC_PCF8563.obj)

line level    source

   1          #include "global_variable.h"
   2          #include "I2cBus.h"
   3          #include <string.h>
   4          #include "Project.h"
   5          
   6          #define PCF8653_CONFIG_REG0   0x08
   7          #define PCF8653_CONFIG_REG1 0x00
   8          #define PCF8653_CONFIG_REG2  0x00
   9          #define PCF8653_CONFIG_REG3 0x00
  10          #define PCF8653_CONFIG_REG4 0x00
  11          #define PCF8653_CONFIG_REG5 0x00
  12          #define PCF8653_CONFIG_REG6 0x00
  13          #define PCF8653_CONFIG_REG7   0x00
  14          #define PCF8653_CONFIG_REG8   0x18
  15          #define PCF8653_CONFIG_REG9   0x80
  16          #define PCF8653_CONFIG_REG10  0x80
  17          #define PCF8653_CONFIG_REG11  0x80
  18          #define PCF8653_CONFIG_REG12  0x80
  19          #define PCF8653_CONFIG_REG13  0x00
  20          #define PCF8653_CONFIG_REG14  0x00
  21          #define PCF8653_CONFIG_REG15  0x00
  22          
  23          void PCF8563_Init(void)
  24          {
  25   1        #ifdef Function_USE_External_RTC
                uint8_t PCF8653_CONFIG_REG_BUFF[]={
                  PCF8653_CONFIG_REG0,PCF8653_CONFIG_REG1,PCF8653_CONFIG_REG9,PCF8653_CONFIG_REG10,
                  PCF8653_CONFIG_REG11,PCF8653_CONFIG_REG12,PCF8653_CONFIG_REG13
                };
                I2C_WriteSequential(I2CADDR_RTC,0x00,PCF8653_CONFIG_REG_BUFF,(uint8_t)strlen(PCF8653_CONFIG_REG_BUFF));
                #endif
  32   1      }
  33          
  34          void PCF8563_WriteTime(void)
  35          {
  36   1        #ifdef Function_USE_External_RTC
                uint8_t BUFF[7];
              
                BUFF[0]= SystemTime.second; 
                BUFF[1]= SystemTime.minute; 
                BUFF[2]= SystemTime.hour;
                BUFF[3]= SystemTime.date;
                BUFF[4]= SystemTime.day;
                BUFF[5]= SystemTime.month;
                BUFF[6]= SystemTime.year;
              
                I2C_WriteSequential(I2CADDR_RTC,0x02,&BUFF[0],7);
              
                #endif
  50   1        
  51   1      }
  52          
C51 COMPILER V9.60.0.0   RTC_PCF8563                                                       05/12/2023 14:54:15 PAGE 2   

  53          void PCF8563_ReadTime(void)
  54          {
  55   1        #ifdef Function_USE_External_RTC
                uint8_t BUFF[7];
              
                I2C_ReadSequential(I2CADDR_RTC,0x02,&BUFF[0],7);
              
                //DEBUG_MARK;
                if( (BUFF[0]&0x7F) >= 0x60 || (BUFF[0]&0x0F)>0x09 ||
                    (BUFF[1]&0x7F) >= 0x60 || (BUFF[1]&0x0F)>0x09 ||
                    (BUFF[2]&0x3F) >= 0x24 || (BUFF[2]&0x0F)>0x09 ||
                    (BUFF[3]&0x3F) >  0x31 || (BUFF[3]&0x0F)>0x09 || (BUFF[3]&0x3F) == 0x00 ||
                    //(BUFF[4]&0x07) >= 0x08 ||
                    (BUFF[5]&0x1F) >  0x12 || (BUFF[5]&0x0F)>0x09 || (BUFF[5]&0x1F) == 0x00 ||
                     BUFF[6]>0x99          || (BUFF[6]&0x0F)>0x09   )
                {
                  PCF8563_Init();
                  PCF8563_WriteTime();
                  return;
                }
                
                SystemTime.second   =   BUFF[0]&0x7F;   //Voltage Low bit is not care
                SystemTime.minute   =   BUFF[1]&0x7F; 
                SystemTime.hour     =   BUFF[2]&0x3F; 
                SystemTime.date     =   BUFF[3]&0x3F;
                SystemTime.day    =   BUFF[4]&0x07;
                SystemTime.month  =   BUFF[5]&0x1F;   //CENTURY BIT is not care 
                SystemTime.year     = BUFF[6];
                #endif
  82   1        
  83   1      }
  84          
  85          void PCF8563_Test(void)
  86          {
  87   1        #if 0
                uint8_t BUFF[7];
              
                BUFF[0]= 33;  
                BUFF[1]= 22;  
                BUFF[2]= 11;
                BUFF[3]= 4;
                BUFF[4]= 5;
                BUFF[5]= 6;
                BUFF[6]= 7;
              
                I2C_WriteSequential(I2CADDR_RTC,0x02,&BUFF[0],7);
                BUFF[0]= 0; 
                BUFF[1]= 0; 
                BUFF[2]= 0;
                BUFF[3]= 0;
                BUFF[4]= 0;
                BUFF[5]= 0;
                BUFF[6]= 0;
                
                I2C_ReadSequential(I2CADDR_RTC,0x02,&BUFF[0],7);
                #endif
 109   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =      4    ----
   CONSTANT SIZE    =   ----    ----
C51 COMPILER V9.60.0.0   RTC_PCF8563                                                       05/12/2023 14:54:15 PAGE 3   

   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
