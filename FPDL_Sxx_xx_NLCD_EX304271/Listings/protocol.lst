C51 COMPILER V9.60.0.0   PROTOCOL                                                          03/08/2023 18:02:10 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE PROTOCOL
OBJECT MODULE PLACED IN .\Objects\protocol.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE Drivers\Protocol\WIFI_Tuya\protocol.c LARGE OMF2 OPTIMIZE(9,SPEED) BROWS
                    -E INCDIR(.\Drivers\Lib\c;.\Drivers\Lib\H;.\Drivers\Lib\IAP_Lib;.\Drivers\Lib\TouchKey_lib;.\Drivers\Physical;.\Drivers\P
                    -rotocol;.\Softwares\Application;.\Softwares\Basic;.\Softwares\ModuleLogic;.\Drivers\Protocol\YC_NFC;.\Drivers\Protocol\W
                    -IFI_Tuya) DEBUG PRINT(.\Listings\protocol.lst) TABS(2) OBJECT(.\Objects\protocol.obj)

line level    source

   1          /**********************************Copyright (c)**********************************
   2          **                       ç‰ˆæƒæ‰€æœ‰ (C), 2015-2020, æ¶‚é¸¦ç§‘æŠ€
   3          **
   4          **                             http://www.tuya.com
   5          **
   6          *********************************************************************************/
   7          /**
   8           * @file    protocol.c
   9           * @author  æ¶‚é¸¦ç»¼åˆåè®®å¼€å‘ç»„
  10           * @version v1.0.7
  11           * @date    2020.11.9
  12           * @brief                
  13           *                       *******éå¸¸é‡è¦ï¼Œä¸€å®šè¦çœ‹å“¦ï¼ï¼ï¼********
  14           *          1. ç”¨æˆ·åœ¨æ­¤æ–‡ä»¶ä¸­å®ç°æ•°æ®ä¸‹å‘/ä¸ŠæŠ¥åŠŸèƒ½
  15           *          2. DPçš„ID/TYPEåŠæ•°æ®å¤„ç†å‡½æ•°éƒ½éœ€è¦ç”¨æˆ·æŒ‰ç…§å®é™…å®šä¹‰å®ç°
  16           *          3. å½“å¼€å§‹æŸäº›å®å®šä¹‰åéœ€è¦ç”¨æˆ·å®ç°ä»£ç çš„å‡½æ•°å†…éƒ¨æœ‰#erræç¤º,å®Œæˆå‡½æ•
             -°åè¯·åˆ é™¤è¯¥#err
  17           */
  18          
  19          #include "protocol.h"
  20          #include "wifi.h"
  21          #include "mcu_api.h"
  22          #include "usart.h"
  23          
  24          
  25          /******************************************************************************
  26                                          ç§»æ¤é¡»çŸ¥:
  27          1:MCUå¿…é¡»åœ¨whileä¸­ç›´æ¥è°ƒç”¨mcu_api.cå†…çš„wifi_uart_service()å‡½æ•°
  28          2:ç¨‹åºæ­£å¸¸åˆå§‹åŒ–å®Œæˆå,å»ºè®®ä¸è¿›è¡Œå…³ä¸²å£ä¸­æ–­,å¦‚å¿…é¡»å…³ä¸­æ–­,å…³ä¸­æ–­æ—¶é—´å¿…é¡»çŸ
             -­,å…³ä¸­æ–­ä¼šå¼•èµ·ä¸²å£æ•°æ®åŒ…ä¸¢å¤±
  29          3:è¯·å‹¿åœ¨ä¸­æ–­/å®šæ—¶å™¨ä¸­æ–­å†…è°ƒç”¨ä¸ŠæŠ¥å‡½æ•°
  30          ******************************************************************************/
  31          
  32                   
  33          /******************************************************************************
  34                                        ç¬¬ä¸€æ­¥:åˆå§‹åŒ–
  35          1:åœ¨éœ€è¦ä½¿ç”¨åˆ°wifiç›¸å…³æ–‡ä»¶çš„æ–‡ä»¶ä¸­include "wifi.h"
  36          2:åœ¨MCUåˆå§‹åŒ–ä¸­è°ƒç”¨mcu_api.cæ–‡ä»¶ä¸­çš„wifi_protocol_init()å‡½æ•°
  37          3:å°†MCUä¸²å£å•å­—èŠ‚å‘é€å‡½æ•°å¡«å…¥protocol.cæ–‡ä»¶ä¸­uart_transmit_outputå‡½æ•°å†…,å¹¶åˆ é™¤#error
  38          4:åœ¨MCUä¸²å£æ¥æ”¶å‡½æ•°ä¸­è°ƒç”¨mcu_api.cæ–‡ä»¶å†…çš„uart_receive_inputå‡½æ•°,å¹¶å°†æ¥æ”¶åˆ°çš„å­—èŠ‚ä
             -½œä¸ºå‚æ•°ä¼ å…¥
  39          5:å•ç‰‡æœºè¿›å…¥whileå¾ªç¯åè°ƒç”¨mcu_api.cæ–‡ä»¶å†…çš„wifi_uart_service()å‡½æ•°
  40          ******************************************************************************/
  41          
  42          /******************************************************************************
  43                                  1:dpæ•°æ®ç‚¹åºåˆ—ç±»å‹å¯¹ç…§è¡¨
  44                    **æ­¤ä¸ºè‡ªåŠ¨ç”Ÿæˆä»£ç ,å¦‚åœ¨å¼€å‘å¹³å°æœ‰ç›¸å…³ä¿®æ”¹è¯·é‡æ–°ä¸‹è½½MCU_SDK**         
  45          ******************************************************************************/
  46          const DOWNLOAD_CMD_S download_cmd[] =
  47          {
  48            {DPID_UNLOCK_FINGERPRINT, DP_TYPE_VALUE},
  49            {DPID_UNLOCK_PASSWORD, DP_TYPE_VALUE},
C51 COMPILER V9.60.0.0   PROTOCOL                                                          03/08/2023 18:02:10 PAGE 2   

  50            {DPID_UNLOCK_TEMPORARY, DP_TYPE_VALUE},
  51            {DPID_UNLOCK_CARD, DP_TYPE_VALUE},
  52            {DPID_ALARM_LOCK, DP_TYPE_ENUM},
  53            {DPID_UNLOCK_REQUEST, DP_TYPE_VALUE},
  54            {DPID_BATTERY_STATE, DP_TYPE_ENUM},
  55            {DPID_UNLOCK_APP, DP_TYPE_VALUE},
  56            {DPID_HIJACK, DP_TYPE_BOOL},
  57            {DPID_DOORBELL, DP_TYPE_BOOL},
  58            {DPID_UPDATE_ALL_FINGER, DP_TYPE_RAW},
  59            {DPID_UPDATE_ALL_PASSWORD, DP_TYPE_RAW},
  60            {DPID_UPDATE_ALL_CARD, DP_TYPE_RAW},
  61            {DPID_REMOTE_NO_PD_SETKEY, DP_TYPE_RAW},
  62            {DPID_REMOTE_NO_DP_KEY, DP_TYPE_RAW},
  63            {DPID_INITIATIVE_MESSAGE, DP_TYPE_RAW},
  64          };
  65          
  66          
  67          
  68          /******************************************************************************
  69                                     2:ä¸²å£å•å­—èŠ‚å‘é€å‡½æ•°
  70          è¯·å°†MCUä¸²å£å‘é€å‡½æ•°å¡«å…¥è¯¥å‡½æ•°å†…,å¹¶å°†æ¥æ”¶åˆ°çš„æ•°æ®ä½œä¸ºå‚æ•°ä¼ å…¥ä¸²å£å‘é€å‡½æ•°
  71          ******************************************************************************/
  72          
  73          /**
  74           * @brief  ä¸²å£å‘é€æ•°æ®
  75           * @param[in] {value} ä¸²å£è¦å‘é€çš„1å­—èŠ‚æ•°æ®
  76           * @return Null
  77           * @note   è¯·å°†MCUä¸²å£å‘é€å‡½æ•°å¡«å…¥è¯¥å‡½æ•°å†…,å¹¶å°†æ¥æ”¶åˆ°çš„æ•°æ®ä½œä¸ºå‚æ•°ä¼ å…¥ä¸²å£å
             -‘é€å‡½æ•°
  78           */
  79          void uart_transmit_output(unsigned char value)
  80          {
  81   1          //#error "è¯·å°†MCUä¸²å£å‘é€å‡½æ•°å¡«å…¥è¯¥å‡½æ•°,å¹¶åˆ é™¤è¯¥è¡Œ"
  82   1          Uart3SendByte(value);
  83   1      /*
  84   1          //ç¤ºä¾‹:
  85   1          extern void Uart_PutChar(unsigned char value);
  86   1          Uart_PutChar(value);                                  //ä¸²å£å‘é€å‡½æ•°
  87   1      */
  88   1      }
  89          /******************************************************************************
  90                                     ç¬¬äºŒæ­¥:å®ç°å…·ä½“ç”¨æˆ·å‡½æ•°
  91          1:APPä¸‹å‘æ•°æ®å¤„ç†
  92          2:æ•°æ®ä¸ŠæŠ¥å¤„ç†
  93          ******************************************************************************/
  94          
  95          /******************************************************************************
  96                                      1:æ‰€æœ‰æ•°æ®ä¸ŠæŠ¥å¤„ç†
  97          å½“å‰å‡½æ•°å¤„ç†å…¨éƒ¨æ•°æ®ä¸ŠæŠ¥(åŒ…æ‹¬å¯ä¸‹å‘/å¯ä¸ŠæŠ¥å’Œåªä¸ŠæŠ¥)
  98            éœ€è¦ç”¨æˆ·æŒ‰ç…§å®é™…æƒ…å†µå®ç°:
  99            1:éœ€è¦å®ç°å¯ä¸‹å‘/å¯ä¸ŠæŠ¥æ•°æ®ç‚¹ä¸ŠæŠ¥
 100            2:éœ€è¦å®ç°åªä¸ŠæŠ¥æ•°æ®ç‚¹ä¸ŠæŠ¥
 101          æ­¤å‡½æ•°ä¸ºMCUå†…éƒ¨å¿…é¡»è°ƒç”¨
 102          ç”¨æˆ·ä¹Ÿå¯è°ƒç”¨æ­¤å‡½æ•°å®ç°å…¨éƒ¨æ•°æ®ä¸ŠæŠ¥
 103          ******************************************************************************/
 104          
 105          //è‡ªåŠ¨åŒ–ç”Ÿæˆæ•°æ®ä¸ŠæŠ¥å‡½æ•°
 106          
 107          /**
 108           * @brief  ç³»ç»Ÿæ‰€æœ‰dpç‚¹ä¿¡æ¯ä¸Šä¼ ,å®ç°APPå’Œmucæ•°æ®åŒæ­¥
 109           * @param  Null
 110           * @return Null
C51 COMPILER V9.60.0.0   PROTOCOL                                                          03/08/2023 18:02:10 PAGE 3   

 111           * @note   æ­¤å‡½æ•°SDKå†…éƒ¨éœ€è°ƒç”¨ï¼ŒMCUå¿…é¡»å®ç°è¯¥å‡½æ•°å†…æ•°æ®ä¸ŠæŠ¥åŠŸèƒ½ï¼ŒåŒ…æ‹¬åªä¸ŠæŠ¥å’
             -Œå¯ä¸ŠæŠ¥å¯ä¸‹å‘å‹æ•°æ®
 112           */
 113          void all_data_update(void)
 114          {
 115   1          //#error "è¯·åœ¨æ­¤å¤„ç†å¯ä¸‹å‘å¯ä¸ŠæŠ¥æ•°æ®åŠåªä¸ŠæŠ¥æ•°æ®ç¤ºä¾‹,å¤„ç†å®Œæˆååˆ é™¤è¯¥è¡Œ"
 116   1           
 117   1          //æ­¤ä»£ç ä¸ºå¹³å°è‡ªåŠ¨ç”Ÿæˆï¼Œè¯·æŒ‰ç…§å®é™…æ•°æ®ä¿®æ”¹æ¯ä¸ªå¯ä¸‹å‘å¯ä¸ŠæŠ¥å‡½æ•°å’Œåªä¸Šæ
             -Š¥å‡½æ•°
 118   1          mcu_dp_value_update(DPID_UNLOCK_FINGERPRINT,1); //VALUEå‹æ•°æ®ä¸ŠæŠ¥;
 119   1          mcu_dp_value_update(DPID_UNLOCK_PASSWORD,1); //VALUEå‹æ•°æ®ä¸ŠæŠ¥;
 120   1          mcu_dp_value_update(DPID_UNLOCK_TEMPORARY,1); //VALUEå‹æ•°æ®ä¸ŠæŠ¥;
 121   1          mcu_dp_value_update(DPID_UNLOCK_CARD,1); //VALUEå‹æ•°æ®ä¸ŠæŠ¥;
 122   1          mcu_dp_enum_update(DPID_ALARM_LOCK,1); //æšä¸¾å‹æ•°æ®ä¸ŠæŠ¥;
 123   1          mcu_dp_value_update(DPID_UNLOCK_REQUEST,1); //VALUEå‹æ•°æ®ä¸ŠæŠ¥;
 124   1          mcu_dp_enum_update(DPID_BATTERY_STATE,1); //æšä¸¾å‹æ•°æ®ä¸ŠæŠ¥;
 125   1          mcu_dp_value_update(DPID_UNLOCK_APP,1); //VALUEå‹æ•°æ®ä¸ŠæŠ¥;
 126   1          mcu_dp_bool_update(DPID_HIJACK,1); //BOOLå‹æ•°æ®ä¸ŠæŠ¥;
 127   1          mcu_dp_bool_update(DPID_DOORBELL,1); //BOOLå‹æ•°æ®ä¸ŠæŠ¥;
 128   1          mcu_dp_raw_update(DPID_UPDATE_ALL_FINGER,1); //RAWå‹æ•°æ®ä¸ŠæŠ¥;
*** WARNING C209 IN LINE 128 OF Drivers\Protocol\WIFI_Tuya\protocol.c: '_mcu_dp_raw_update': too few actual parameters
*** WARNING C196 IN LINE 128 OF Drivers\Protocol\WIFI_Tuya\protocol.c: mspace probably invalid
 129   1          mcu_dp_raw_update(DPID_UPDATE_ALL_PASSWORD,1); //RAWå‹æ•°æ®ä¸ŠæŠ¥;
*** WARNING C209 IN LINE 129 OF Drivers\Protocol\WIFI_Tuya\protocol.c: '_mcu_dp_raw_update': too few actual parameters
*** WARNING C196 IN LINE 129 OF Drivers\Protocol\WIFI_Tuya\protocol.c: mspace probably invalid
 130   1          mcu_dp_raw_update(DPID_UPDATE_ALL_CARD,1); //RAWå‹æ•°æ®ä¸ŠæŠ¥;
*** WARNING C209 IN LINE 130 OF Drivers\Protocol\WIFI_Tuya\protocol.c: '_mcu_dp_raw_update': too few actual parameters
*** WARNING C196 IN LINE 130 OF Drivers\Protocol\WIFI_Tuya\protocol.c: mspace probably invalid
 131   1          //mcu_dp_raw_update(DPID_REMOTE_NO_PD_SETKEY,å½“å‰è®¾ç½®æ–°å…å¯†è¿œç¨‹å¼€é—¨å¯†é’¥æŒ‡é’ˆ,å½“å‰è®¾ç½
             -®æ–°å…å¯†è¿œç¨‹å¼€é—¨å¯†é’¥æ•°æ®é•¿åº¦); //RAWå‹æ•°æ®ä¸ŠæŠ¥;
 132   1          //mcu_dp_raw_update(DPID_REMOTE_NO_DP_KEY,å½“å‰å…å¯†è¿œç¨‹å¼€é—¨æŒ‡é’ˆ,å½“å‰å…å¯†è¿œç¨‹å¼€é—¨æ•°æ
             -®é•¿åº¦); //RAWå‹æ•°æ®ä¸ŠæŠ¥;
 133   1          //mcu_dp_raw_update(DPID_INITIATIVE_MESSAGE,å½“å‰ä¸»åŠ¨æ¶ˆæ¯æ¨é€æŒ‡é’ˆ,å½“å‰ä¸»åŠ¨æ¶ˆæ¯æ¨é€æ•°
             -æ®é•¿åº¦); //RAWå‹æ•°æ®ä¸ŠæŠ¥;
 134   1      
 135   1          
 136   1      }
 137          
 138          
 139          /******************************************************************************
 140                                          WARNING!!!    
 141                                      2:æ‰€æœ‰æ•°æ®ä¸ŠæŠ¥å¤„ç†
 142          è‡ªåŠ¨åŒ–ä»£ç æ¨¡æ¿å‡½æ•°,å…·ä½“è¯·ç”¨æˆ·è‡ªè¡Œå®ç°æ•°æ®å¤„ç†
 143          ******************************************************************************/
 144          /*****************************************************************************
 145          å‡½æ•°åç§° : dp_download_remote_no_pd_setkey_handle
 146          åŠŸèƒ½æè¿° : é’ˆå¯¹DPID_REMOTE_NO_PD_SETKEYçš„å¤„ç†å‡½æ•°
 147          è¾“å…¥å‚æ•° : value:æ•°æ®æºæ•°æ®
 148                  : length:æ•°æ®é•¿åº¦
 149          è¿”å›å‚æ•° : æˆåŠŸè¿”å›:SUCCESS/å¤±è´¥è¿”å›:ERROR
 150          ä½¿ç”¨è¯´æ˜ : å¯ä¸‹å‘å¯ä¸ŠæŠ¥ç±»å‹,éœ€è¦åœ¨å¤„ç†å®Œæ•°æ®åä¸ŠæŠ¥å¤„ç†ç»“æœè‡³app
 151          *****************************************************************************/
 152          static unsigned char dp_download_remote_no_pd_setkey_handle(const unsigned char value[], unsigned short le
             -ngth)
 153          {
 154   1          //ç¤ºä¾‹:å½“å‰DPç±»å‹ä¸ºRAW
 155   1          unsigned char ret;
 156   1          /*
 157   1          //RAW type _data processing
 158   1          
 159   1          */
 160   1          
C51 COMPILER V9.60.0.0   PROTOCOL                                                          03/08/2023 18:02:10 PAGE 4   

 161   1          //There should be a report after processing the DP
 162   1          ret = mcu_dp_raw_update(DPID_REMOTE_NO_PD_SETKEY,value,length);
 163   1          if(ret == SUCCESS)
 164   1              return SUCCESS;
 165   1          else
 166   1              return ERROR;
 167   1      }
 168          /*****************************************************************************
 169          å‡½æ•°åç§° : dp_download_remote_no_dp_key_handle
 170          åŠŸèƒ½æè¿° : é’ˆå¯¹DPID_REMOTE_NO_DP_KEYçš„å¤„ç†å‡½æ•°
 171          è¾“å…¥å‚æ•° : value:æ•°æ®æºæ•°æ®
 172                  : length:æ•°æ®é•¿åº¦
 173          è¿”å›å‚æ•° : æˆåŠŸè¿”å›:SUCCESS/å¤±è´¥è¿”å›:ERROR
 174          ä½¿ç”¨è¯´æ˜ : å¯ä¸‹å‘å¯ä¸ŠæŠ¥ç±»å‹,éœ€è¦åœ¨å¤„ç†å®Œæ•°æ®åä¸ŠæŠ¥å¤„ç†ç»“æœè‡³app
 175          *****************************************************************************/
 176          static unsigned char dp_download_remote_no_dp_key_handle(const unsigned char value[], unsigned short lengt
             -h)
 177          {
 178   1          //ç¤ºä¾‹:å½“å‰DPç±»å‹ä¸ºRAW
 179   1          unsigned char ret;
 180   1          /*
 181   1          //RAW type _data processing 
 182   1          */
 183   1          
 184   1          //There should be a report after processing the DP
 185   1          ret = mcu_dp_raw_update(DPID_REMOTE_NO_DP_KEY,value,length);
 186   1          if(ret == SUCCESS)
 187   1              return SUCCESS;
 188   1          else
 189   1              return ERROR;
 190   1      }
 191          /*****************************************************************************
 192          å‡½æ•°åç§° : dp_download_initiative_message_handle
 193          åŠŸèƒ½æè¿° : é’ˆå¯¹DPID_INITIATIVE_MESSAGEçš„å¤„ç†å‡½æ•°
 194          è¾“å…¥å‚æ•° : value:æ•°æ®æºæ•°æ®
 195                  : length:æ•°æ®é•¿åº¦
 196          è¿”å›å‚æ•° : æˆåŠŸè¿”å›:SUCCESS/å¤±è´¥è¿”å›:ERROR
 197          ä½¿ç”¨è¯´æ˜ : å¯ä¸‹å‘å¯ä¸ŠæŠ¥ç±»å‹,éœ€è¦åœ¨å¤„ç†å®Œæ•°æ®åä¸ŠæŠ¥å¤„ç†ç»“æœè‡³app
 198          *****************************************************************************/
 199          static unsigned char dp_download_initiative_message_handle(const unsigned char value[], unsigned short len
             -gth)
 200          {
 201   1          //ç¤ºä¾‹:å½“å‰DPç±»å‹ä¸ºRAW
 202   1          unsigned char ret;
 203   1          /*
 204   1          //RAW type _data processing
 205   1          
 206   1          */
 207   1          
 208   1          //There should be a report after processing the DP
 209   1          ret = mcu_dp_raw_update(DPID_INITIATIVE_MESSAGE,value,length);
 210   1          if(ret == SUCCESS)
 211   1              return SUCCESS;
 212   1          else
 213   1              return ERROR;
 214   1      }
 215          
 216          
 217          
 218          
 219          
 220          /******************************************************************************
C51 COMPILER V9.60.0.0   PROTOCOL                                                          03/08/2023 18:02:10 PAGE 5   

 221                                          WARNING!!!                     
 222          ä»¥ä¸‹å‡½æ•°ç”¨æˆ·è¯·å‹¿ä¿®æ”¹!!
 223          ******************************************************************************/
 224          /**
 225           * @brief  dpä¸‹å‘å¤„ç†å‡½æ•°
 226           * @param[in] {dpid} dpid åºå·
 227           * @param[in] {value} dpæ•°æ®ç¼“å†²åŒºåœ°å€
 228           * @param[in] {length} dpæ•°æ®é•¿åº¦
 229           * @return dpå¤„ç†ç»“æœ
 230           * -           0(ERROR): å¤±è´¥
 231           * -           1(SUCCESS): æˆåŠŸ
 232           * @note   è¯¥å‡½æ•°ç”¨æˆ·ä¸èƒ½ä¿®æ”¹
 233           */
 234          unsigned char dp_download_handle(unsigned char dpid,const unsigned char value[], unsigned short length)
 235          {
 236   1          /*********************************
 237   1          å½“å‰å‡½æ•°å¤„ç†å¯ä¸‹å‘/å¯ä¸ŠæŠ¥æ•°æ®è°ƒç”¨                    
 238   1          å…·ä½“å‡½æ•°å†…éœ€è¦å®ç°ä¸‹å‘æ•°æ®å¤„ç†
 239   1          å®Œæˆç”¨éœ€è¦å°†å¤„ç†ç»“æœåé¦ˆè‡³APPç«¯,å¦åˆ™APPä¼šè®¤ä¸ºä¸‹å‘å¤±è´¥
 240   1          ***********************************/
 241   1          unsigned char ret;
 242   1          switch(dpid) {
 243   2              case DPID_REMOTE_NO_PD_SETKEY:
 244   2                  //è®¾ç½®æ–°å…å¯†è¿œç¨‹å¼€é—¨å¯†é’¥å¤„ç†å‡½æ•°
 245   2                  ret = dp_download_remote_no_pd_setkey_handle(value,length);
 246   2              break;
 247   2              case DPID_REMOTE_NO_DP_KEY:
 248   2                  //å…å¯†è¿œç¨‹å¼€é—¨å¤„ç†å‡½æ•°
 249   2                  ret = dp_download_remote_no_dp_key_handle(value,length);
 250   2              break;
 251   2              case DPID_INITIATIVE_MESSAGE:
 252   2                  //ä¸»åŠ¨æ¶ˆæ¯æ¨é€å¤„ç†å‡½æ•°
 253   2                  ret = dp_download_initiative_message_handle(value,length);
 254   2              break;
 255   2      
 256   2      
 257   2            default:
 258   2            break;
 259   2          }
 260   1          return ret;
 261   1      }
 262          
 263          /**
 264           * @brief  è·å–æ‰€æœ‰dpå‘½ä»¤æ€»å’Œ
 265           * @param[in] Null
 266           * @return ä¸‹å‘å‘½ä»¤æ€»å’Œ
 267           * @note   è¯¥å‡½æ•°ç”¨æˆ·ä¸èƒ½ä¿®æ”¹
 268           */
 269          unsigned char get_download_cmd_total(void)
 270          {
 271   1          return(sizeof(download_cmd) / sizeof(download_cmd[0]));
 272   1      }
 273          
 274          
 275          
 276          /******************************************************************************
 277                                          WARNING!!!                     
 278          æ­¤ä»£ç ä¸ºSDKå†…éƒ¨è°ƒç”¨,è¯·æŒ‰ç…§å®é™…dpæ•°æ®å®ç°å‡½æ•°å†…éƒ¨æ•°æ®
 279          ******************************************************************************/
 280          #ifdef SUPPORT_MCU_RTC_CHECK
              /**
               * @brief  MCUæ ¡å¯¹æœ¬åœ°RTCæ—¶é’Ÿ
C51 COMPILER V9.60.0.0   PROTOCOL                                                          03/08/2023 18:02:10 PAGE 6   

               * @param[in] {time} è·å–åˆ°çš„æ ¼æ—æ—¶é—´æ•°æ®
               * @return Null
               * @note   MCUéœ€è¦è‡ªè¡Œå®ç°è¯¥åŠŸèƒ½
               */
              void mcu_write_rtctime(unsigned char time[])
              {
                  #error "è¯·è‡ªè¡Œå®ŒæˆRTCæ—¶é’Ÿå†™å…¥ä»£ç ,å¹¶åˆ é™¤è¯¥è¡Œ"
                  /*
                  time[0]ä¸ºæ˜¯å¦è·å–æ—¶é—´æˆåŠŸæ ‡å¿—ï¼Œä¸º 0 è¡¨ç¤ºå¤±è´¥ï¼Œä¸º 1è¡¨ç¤ºæˆåŠŸ
                  time[1] ä¸º å¹´ ä»½ , 0x00 è¡¨ ç¤º2000 å¹´
                  time[2]ä¸ºæœˆä»½ï¼Œä» 1 å¼€å§‹åˆ°12 ç»“æŸ
                  time[3]ä¸ºæ—¥æœŸï¼Œä» 1 å¼€å§‹åˆ°31 ç»“æŸ
                  time[4]ä¸ºæ—¶é’Ÿï¼Œä» 0 å¼€å§‹åˆ°23 ç»“æŸ
                  time[5]ä¸ºåˆ†é’Ÿï¼Œä» 0 å¼€å§‹åˆ°59 ç»“æŸ
                  time[6]ä¸ºç§’é’Ÿï¼Œä» 0 å¼€å§‹åˆ°59 ç»“æŸ
                  time[7]ä¸ºæ˜ŸæœŸï¼Œä» 1 å¼€å§‹åˆ° 7 ç»“æŸï¼Œ1ä»£è¡¨æ˜ŸæœŸä¸€
                 */
                  if(time[0] == 1) {
                    //æ­£ç¡®æ¥æ”¶åˆ°wifiæ¨¡å—è¿”å›çš„æœ¬åœ°æ—¶é’Ÿæ•°æ® 
                   
                  }else {
                    //è·å–æœ¬åœ°æ—¶é’Ÿæ•°æ®å‡ºé”™,æœ‰å¯èƒ½æ˜¯å½“å‰wifiæ¨¡å—æœªè”ç½‘
                  }
              }
              #endif
 308          
 309          #ifdef SUPPORT_GREEN_TIME
 310          /**
 311           * @brief  MCUæŸ¥è¯¢æ ¼æ—æ—¶é—´è¿”å›å‡½æ•°
 312           * @param[in] {gl_time} è¿”å›çš„å½“å‰æ ¼æ—æ—¶é—´(ä»ä½åˆ°é«˜7ä½ï¼Œåˆ†åˆ«ä¸ºå¹´æœˆæ—¥æ—¶åˆ†ç§’æ˜ŸæœŸ)
 313           * @return Null
 314           * @note   MCUä¸»åŠ¨è°ƒç”¨ mcu_get_gelin_time æˆåŠŸå,è¯¥å‡½æ•°å†…å¯è·å–æ ¼æ—æ—¶é—´
 315           */
 316          void mcu_write_gltime(unsigned char gl_time[])
 317          {
 318   1          //#error "è¯·è‡ªè¡Œå®Œæˆæ ¼æ—æ—¶é—´è®°å½•ä»£ç ,å¹¶åˆ é™¤è¯¥è¡Œ"
 319   1          /*
 320   1          gl_time[0]ä¸ºæ˜¯å¦è·å–æ—¶é—´æˆåŠŸæ ‡å¿—ï¼Œä¸º 0 è¡¨ç¤ºå¤±è´¥ï¼Œä¸º 1è¡¨ç¤ºæˆåŠŸ
 321   1          gl_time[1]ä¸ºå¹´ä»½ , 0x00 è¡¨ç¤º 2000 å¹´
 322   1          gl_time[2]ä¸ºæœˆä»½ï¼Œä» 1 å¼€å§‹åˆ°12 ç»“æŸ
 323   1          gl_time[3]ä¸ºæ—¥æœŸï¼Œä» 1 å¼€å§‹åˆ°31 ç»“æŸ
 324   1          gl_time[4]ä¸ºæ—¶é’Ÿï¼Œä» 0 å¼€å§‹åˆ°23 ç»“æŸ
 325   1          gl_time[5]ä¸ºåˆ†é’Ÿï¼Œä» 0 å¼€å§‹åˆ°59 ç»“æŸ
 326   1          gl_time[6]ä¸ºç§’é’Ÿï¼Œä» 0 å¼€å§‹åˆ°59 ç»“æŸ
 327   1          gl_time[7]ä¸ºæ˜ŸæœŸï¼Œä» 1 å¼€å§‹åˆ° 7 ç»“æŸï¼Œ1ä»£è¡¨æ˜ŸæœŸä¸€
 328   1         */
 329   1          if(gl_time[0] == 1) {
 330   2            //æ­£ç¡®æ¥æ”¶åˆ°wifiæ¨¡å—è¿”å›çš„æœ¬åœ°æ—¶é’Ÿæ•°æ® 
 331   2           
 332   2          }else {
 333   2            //è·å–æœ¬åœ°æ—¶é’Ÿæ•°æ®å‡ºé”™,æœ‰å¯èƒ½æ˜¯å½“å‰wifiæ¨¡å—æœªè”ç½‘
 334   2          }
 335   1      }
 336          #endif
 337          
 338          #ifdef WIFI_TEST_ENABLE
 339          /**
 340           * @brief  wifiåŠŸèƒ½æµ‹è¯•åé¦ˆ
 341           * @param[in] {result} wifiåŠŸèƒ½æµ‹è¯•ç»“æœ
 342           * @ref       0: å¤±è´¥
 343           * @ref       1: æˆåŠŸ
 344           * @param[in] {rssi} æµ‹è¯•æˆåŠŸè¡¨ç¤ºwifiä¿¡å·å¼ºåº¦/æµ‹è¯•å¤±è´¥è¡¨ç¤ºé”™è¯¯ç±»å‹
C51 COMPILER V9.60.0.0   PROTOCOL                                                          03/08/2023 18:02:10 PAGE 7   

 345           * @return Null
 346           * @note   MCUéœ€è¦è‡ªè¡Œå®ç°è¯¥åŠŸèƒ½
 347           */
 348          void wifi_test_result(unsigned char result,unsigned char rssi)
 349          {
 350   1          //#error "è¯·è‡ªè¡Œå®ç°wifiåŠŸèƒ½æµ‹è¯•æˆåŠŸ/å¤±è´¥ä»£ç ,å®Œæˆåè¯·åˆ é™¤è¯¥è¡Œ"
 351   1          if(result == 0) {
 352   2              //æµ‹è¯•å¤±è´¥
 353   2              if(rssi == 0x00) {
 354   3                  //æœªæ‰«æåˆ°åç§°ä¸ºtuya_mdev_testè·¯ç”±å™¨,è¯·æ£€æŸ¥
 355   3              }else if(rssi == 0x01) {
 356   3                  //æ¨¡å—æœªæˆæƒ
 357   3              }
 358   2          }else {
 359   2              //æµ‹è¯•æˆåŠŸ
 360   2              //rssiä¸ºä¿¡å·å¼ºåº¦(0-100, 0ä¿¡å·æœ€å·®ï¼Œ100ä¿¡å·æœ€å¼º)
 361   2          }
 362   1      }
 363          #endif
 364          
 365          /**
 366           * @brief  MCUè¯·æ±‚wifiå›ºä»¶å‡çº§è¿”å›å‡½æ•°
 367           * @param[in] {status} æ ¡éªŒæ ‡å¿—
 368           * @return Null
 369           * @note   MCUä¸»åŠ¨è°ƒç”¨ wifi_update_request å‡½æ•°å®Œæˆåè¯¥å‡½æ•°å†…å¯è·å–å‡çº§å½“å‰çŠ¶æ€
 370           */
 371          void wifi_update_handle(unsigned char status)
 372          { 
 373   1          //#error "è¯·è‡ªè¡Œå®Œæˆwifiæ¨¡å—å‡çº§çŠ¶æ€è¿”å›ä»£ç ,å¹¶åˆ é™¤è¯¥è¡Œ"
 374   1      
 375   1          switch (status) {
 376   2              case 0: {
 377   3                  //å¼€å§‹æ£€æŸ¥å›ºä»¶æ›´æ–°
 378   3                  break;
 379   3              }
 380   2      
 381   2              case 1: {
 382   3                  //å·²ç»æ˜¯æœ€æ–°å›ºä»¶
 383   3                  break;
 384   3              }
 385   2      
 386   2              case 2: {
 387   3                  //æ­£åœ¨æ›´æ–°å›ºä»¶
 388   3                  break;
 389   3              }
 390   2      
 391   2              case 3: {
 392   3                  //å›ºä»¶æ›´æ–°æˆåŠŸ
 393   3                  break;
 394   3              }
 395   2      
 396   2              case 4: {
 397   3                  //å›ºä»¶æ›´æ–°å¤±è´¥
 398   3                  break;
 399   3              }
 400   2      
 401   2              default:
 402   2              break;
 403   2          }
 404   1      }
 405          
 406          #ifdef SUPPORT_MCU_FIRM_UPDATE
C51 COMPILER V9.60.0.0   PROTOCOL                                                          03/08/2023 18:02:10 PAGE 8   

 407          /**
 408           * @brief  MCUè¯·æ±‚mcuå›ºä»¶å‡çº§
 409           * @param  Null
 410           * @return Null
 411           * @note   MCUä¸»åŠ¨è°ƒç”¨å®Œæˆååœ¨ mcu_update_handle å‡½æ•°å†…å¯è·å–å‡çº§å½“å‰çŠ¶æ€
 412           */
 413          void mcu_update_request(void)
 414          { 
 415   1          wifi_uart_write_frame(MCU_UG_REQ_CMD, 0);
 416   1      }
 417          
 418          /**
 419           * @brief  MCUè¯·æ±‚mcuå›ºä»¶å‡çº§è¿”å›å‡½æ•°
 420           * @param[in] {status} æ ¡éªŒæ ‡å¿—
 421           * @return Null
 422           * @note   MCUä¸»åŠ¨è°ƒç”¨ mcu_update_request å‡½æ•°å®Œæˆåè¯¥å‡½æ•°å†…å¯è·å–å‡çº§å½“å‰çŠ¶æ€
 423           */
 424          void mcu_update_handle(unsigned char status)
 425          { 
 426   1          //#error "è¯·è‡ªè¡Œå®Œæˆmcuå‡çº§çŠ¶æ€å¤„ç†ä»£ç ,å¹¶åˆ é™¤è¯¥è¡Œ"
 427   1      
 428   1          switch (status) {
 429   2              case 0: {
 430   3                  //å¼€å§‹æ£€æŸ¥å›ºä»¶æ›´æ–°
 431   3                  break;
 432   3              }
 433   2      
 434   2              case 1: {
 435   3                  //å·²ç»æ˜¯æœ€æ–°å›ºä»¶
 436   3                  break;
 437   3              }
 438   2      
 439   2              case 2: {
 440   3                  //æ­£åœ¨æ›´æ–°å›ºä»¶
 441   3                  break;
 442   3              }
 443   2      
 444   2              case 3: {
 445   3                  //å›ºä»¶æ›´æ–°æˆåŠŸ
 446   3                  break;
 447   3              }
 448   2      
 449   2              case 4: {
 450   3                  //å›ºä»¶æ›´æ–°å¤±è´¥
 451   3                  break;
 452   3              }
 453   2      
 454   2              default:
 455   2              break;
 456   2          }
 457   1      }
 458          
 459          /**
 460           * @brief  MCUè¿›å…¥å›ºä»¶å‡çº§æ¨¡å¼
 461           * @param[in] {value} å›ºä»¶ç¼“å†²åŒº
 462           * @param[in] {position} å½“å‰æ•°æ®åŒ…åœ¨äºå›ºä»¶ä½ç½®
 463           * @param[in] {length} å½“å‰å›ºä»¶åŒ…é•¿åº¦(å›ºä»¶åŒ…é•¿åº¦ä¸º0æ—¶,è¡¨ç¤ºå›ºä»¶åŒ…å‘é€å®Œæˆ)
 464           * @return Null
 465           * @note   MCUéœ€è¦è‡ªè¡Œå®ç°è¯¥åŠŸèƒ½
 466           */
 467          unsigned char mcu_firm_update_handle(const unsigned char value[],unsigned long position,unsigned short len
             -gth)
C51 COMPILER V9.60.0.0   PROTOCOL                                                          03/08/2023 18:02:10 PAGE 9   

 468          {
 469   1          //#error "è¯·è‡ªè¡Œå®ŒæˆMCUå›ºä»¶å‡çº§ä»£ç ,å®Œæˆåè¯·åˆ é™¤è¯¥è¡Œ"
 470   1          if(length == 0) {
 471   2              //å›ºä»¶æ•°æ®å‘é€å®Œæˆ
 472   2          }else {
 473   2              //å›ºä»¶æ•°æ®å¤„ç†
 474   2          }
 475   1          
 476   1          return SUCCESS;
 477   1      }
*** WARNING C280 IN LINE 467 OF Drivers\Protocol\WIFI_Tuya\protocol.c: 'value': unreferenced local variable
*** WARNING C280 IN LINE 467 OF Drivers\Protocol\WIFI_Tuya\protocol.c: 'position': unreferenced local variable
 478          #endif
 479          
 480          #ifdef REPORTED_MCU_SN_ENABLE
              /**
               * @brief  MCUä¸ŠæŠ¥SN
               * @param[in] {result} çŠ¶æ€ç»“æœ
               * @return Null
               * @note   MCUéœ€è¦å…ˆè‡ªè¡Œè°ƒç”¨mcu_sn_updataå‡½æ•°åï¼Œåœ¨æ­¤å‡½æ•°å¯¹æ¥æ”¶çš„ç»“æœè¿›è¡Œå¤„ç†
               */
              void mcu_sn_updata_result(unsigned char result)
              {
                  #error "è¯·è‡ªè¡Œå®ŒæˆMCUä¸ŠæŠ¥SNç»“æœå¤„ç†ä»£ç ,å¹¶åˆ é™¤è¯¥è¡Œ"
                  if(0 == result) {
                      //ä¸ŠæŠ¥æˆåŠŸ
                  }else {
                      //ä¸ŠæŠ¥å¤±è´¥
                  }
              }
              #endif
 497          
 498          #ifdef WIFI_RESET_NOTICE_ENABLE
              /**
               * @brief  æ¨¡å—é‡ç½®çŠ¶æ€é€šçŸ¥
               * @param[in] {result} çŠ¶æ€ç»“æœ
               * @return Null
               * @note   MCUéœ€è¦å…ˆè‡ªè¡Œè°ƒç”¨mcu_sn_updataå‡½æ•°åï¼Œåœ¨æ­¤å‡½æ•°å¯¹æ¥æ”¶çš„ç»“æœè¿›è¡Œå¤„ç†
               */
              void wifi_reset_notice(unsigned char result)
              {
                  #error "è¯·è‡ªè¡Œå®Œæˆæ¨¡å—é‡ç½®çŠ¶æ€é€šçŸ¥å¤„ç†ä»£ç ,å¹¶åˆ é™¤è¯¥è¡Œ"
                  
                  switch(result) {
                      case 0x00:
                          //æ¨¡å—æœ¬åœ°é‡ç½®
                      break;
                      
                      case 0x01:
                          //APPè¿œç¨‹é‡ç½®
                      break;
                      
                      case 0x02:
                          //APPæ¢å¤å‡ºå‚é‡ç½®
                      break;
                      
                      case 0x03:
                          //æœ¬åœ°æ•°æ®æ¸…é™¤ï¼Œä½†è®¾å¤‡ä¸ç¦»ç½‘
                      break;
                      
                      default:break;
                  }
C51 COMPILER V9.60.0.0   PROTOCOL                                                          03/08/2023 18:02:10 PAGE 10  

                  wifi_uart_write_frame(WIFI_RESET_NOTICE_CMD, 0);
              }
              #endif
 531          
 532          
 533          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    338    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     32      21
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  8 WARNING(S),  0 ERROR(S)
