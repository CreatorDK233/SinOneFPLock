C51 COMPILER V9.60.0.0   REALTIMECLOCK                                                     09/13/2022 09:51:41 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE REALTIMECLOCK
OBJECT MODULE PLACED IN .\Objects\RealTimeClock.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE Drivers\Drivers_Src\RealTimeClock.c LARGE OMF2 OPTIMIZE(8,SPEED) BROWSE 
                    -INCDIR(.\TouchKey_lib;.\Software\Software_Inc;.\Software\Software_Src;.\Drivers\Drivers_Inc;.\Drivers\Drivers_Src;.\c;.\
                    -H) DEBUG PRINT(.\Listings\RealTimeClock.lst) TABS(2) OBJECT(.\Objects\RealTimeClock.obj)

line level    source

   1          //#include "Project.h"
   2          //#include "IO.h"
   3          //#include "Hardware.h"
   4          //#include "StdTypes.h"
   5          //#include "rtc.h"
   6          #include "I2cBus.h"
   7          #include "RealTimeClock.h"
   8          
   9          
  10          /*************************************************************************************************          
             -                                                     
  11          *  Object:       
  12          *  输入： 无
  13          *  输出： 无                                                                               
  14          *  备注：                                         
  15          ********************************************************************************************************/
  16          
  17          #ifdef RTC_PCF8563
              #define PCF8653_CONFIG_REG0   0x00
              #define PCF8653_CONFIG_REG1   0x00
              
              #define PCF8653_CONFIG_REG2   0x00  //second
              #define PCF8653_CONFIG_REG3   0x00  //minute
              #define PCF8653_CONFIG_REG4   0x12  //hour
              #define PCF8653_CONFIG_REG5   0x01  //day
              #define PCF8653_CONFIG_REG6   0x01  //date,monday
              #define PCF8653_CONFIG_REG7   0x04  //month
              #define PCF8653_CONFIG_REG8   0x19  //year
              
              #define PCF8653_CONFIG_REG9   0x80
              #define PCF8653_CONFIG_REG10  0x80
              #define PCF8653_CONFIG_REG11  0x80
              #define PCF8653_CONFIG_REG12  0x80
              #define PCF8653_CONFIG_REG13  0x00
              #define PCF8653_CONFIG_REG14  0x00
              #define PCF8653_CONFIG_REG15  0x00
              
              static uint8_t TestVal;
              static uint8_t TestBuff1[20];
              
              void RealTimeClock_Init(void) 
              {
                uint8_t temp;
              
                I2C_ReadRandom(I2CADDR_RTC,0x02,&temp);
                
                DEBUG_MARK;
                
                I2C_WriteRandom(I2CADDR_RTC,0x00,PCF8653_CONFIG_REG0);
                I2C_WriteRandom(I2CADDR_RTC,0x01,PCF8653_CONFIG_REG1);
              
                if ((temp&0x80)!=0x00)    //if low voltage is trigger,reset the time
                {
C51 COMPILER V9.60.0.0   REALTIMECLOCK                                                     09/13/2022 09:51:41 PAGE 2   

                    I2C_WriteRandom(I2CADDR_RTC,0x02,PCF8653_CONFIG_REG2);
                    I2C_WriteRandom(I2CADDR_RTC,0x03,PCF8653_CONFIG_REG3);
                  I2C_WriteRandom(I2CADDR_RTC,0x04,PCF8653_CONFIG_REG4);
                    I2C_WriteRandom(I2CADDR_RTC,0x05,PCF8653_CONFIG_REG5);
                  I2C_WriteRandom(I2CADDR_RTC,0x06,PCF8653_CONFIG_REG6);
                    I2C_WriteRandom(I2CADDR_RTC,0x07,PCF8653_CONFIG_REG7);
                  I2C_WriteRandom(I2CADDR_RTC,0x08,PCF8653_CONFIG_REG8);
                }
              
                Hardware_DelayMs(10);
              }
              
              
              void ReadSystemTime(void)
              {
                uint8_t i;
                uint8_t BUFFER[7];
                /*
                for (i=0;i<16;i++)
                {
                  BUFFER[i]=0x00;
                }
                
                DEBUG_MARK;
                */
                //return;
                
                I2C_ReadSequential(I2CADDR_RTC,0x02,&BUFFER[0],7);
              
                SystemTime.second   =   BUFFER[0]&0x7F;   //Voltage Low bit is not care
                SystemTime.minute   =   BUFFER[1]&0x7F; 
                SystemTime.hour     =   BUFFER[2]&0x3F; 
                SystemTime.date     =   BUFFER[3]&0x3F;
                SystemTime.day    =   BUFFER[4]&0x07;
                SystemTime.month  =   BUFFER[5]&0x1F;   //CENTURY BIT is not care 
                SystemTime.year     = BUFFER[6];
              
                DEBUG_MARK;
              }
              
              
              void WriteSystemTime(void)
              {
                uint8_t i;
                uint8_t BUFF[7];
                
                BUFF[0]= SystemTime.second; 
                BUFF[1]= SystemTime.minute; 
                BUFF[2]= SystemTime.hour;
                BUFF[3]= SystemTime.date;
                BUFF[4]= SystemTime.day;
                BUFF[5]= SystemTime.month;
                BUFF[6]= SystemTime.year;
              
                I2C_WriteSequential(I2CADDR_RTC,0x02,&BUFF[0],7);
              
                DEBUG_MARK;
                
                //for (i=0;i<7;i++)
                //{
                //  BUFF[i]=0x88;;
                //}
C51 COMPILER V9.60.0.0   REALTIMECLOCK                                                     09/13/2022 09:51:41 PAGE 3   

              
                //I2C1_ReadSequential(I2CADDR_RTC,0x02,&BUFF[0],7);
              
                DEBUG_MARK;
                
              }
              
              
              
              void PCF8563_Test(void)
              {
                //PCF8563_RegRead(&TestBuff1[0],10);
                
                DEBUG_MARK;
              }
              
              
              #else
 133          void RealTimeClock_Init(void) 
 134          {
 135   1        SystemTime.second =   0x00;
*** ERROR C200 IN LINE 135 OF Drivers\Drivers_Src\RealTimeClock.c: left side of '.' requires struct/union
 136   1        SystemTime.minute =   0x00;
 137   1        SystemTime.hour   =   0x12;
 138   1        SystemTime.date   =   0x01;
 139   1        SystemTime.day    =   0x00;
 140   1        SystemTime.month  =   0x03;
 141   1        SystemTime.year   =   0x19;
 142   1        
 143   1        WriteSystemTime();
 144   1      }
 145          /*************************************************************************************************          
             -                                                     
 146          *  Object:       
 147          *  输入： 无
 148          *  输出： 无                                                                               
 149          *  备注：                                         
 150          ********************************************************************************************************/
 151          void ReadSystemTime(void)
 152          {
 153   1        //return;
 154   1        RTC_TimeTypeDef Temp_RTC_Time;
*** ERROR C202 IN LINE 154 OF Drivers\Drivers_Src\RealTimeClock.c: 'RTC_TimeTypeDef': undefined identifier
*** ERROR C141 IN LINE 154 OF Drivers\Drivers_Src\RealTimeClock.c: syntax error near 'Temp_RTC_Time', expected ';'
 155   1        RTC_DateTypeDef Temp_RTC_Date;
*** ERROR C202 IN LINE 155 OF Drivers\Drivers_Src\RealTimeClock.c: 'RTC_DateTypeDef': undefined identifier
*** ERROR C141 IN LINE 155 OF Drivers\Drivers_Src\RealTimeClock.c: syntax error near 'Temp_RTC_Date', expected ';'
 156   1        HAL_RTC_GetTime(&hrtc,&Temp_RTC_Time,RTC_FORMAT_BCD);
*** ERROR C202 IN LINE 156 OF Drivers\Drivers_Src\RealTimeClock.c: 'hrtc': undefined identifier
 157   1        HAL_RTC_GetDate(&hrtc,&Temp_RTC_Date,RTC_FORMAT_BCD);
*** ERROR C202 IN LINE 157 OF Drivers\Drivers_Src\RealTimeClock.c: 'hrtc': undefined identifier
 158   1        
 159   1        SystemTime.second =   Temp_RTC_Time.Seconds;    
 160   1        SystemTime.minute =   Temp_RTC_Time.Minutes;  
 161   1        SystemTime.hour   =   Temp_RTC_Time.Hours;  
 162   1        SystemTime.date   =   Temp_RTC_Date.Date;
 163   1        SystemTime.day    =   Temp_RTC_Date.WeekDay;
 164   1        SystemTime.month  =   Temp_RTC_Date.Month;    
 165   1        SystemTime.year   = Temp_RTC_Date.Year;
 166   1        
 167   1      }
 168          /*************************************************************************************************          
C51 COMPILER V9.60.0.0   REALTIMECLOCK                                                     09/13/2022 09:51:41 PAGE 4   

             -                                                     
 169          *  Object:       
 170          *  输入： 无
 171          *  输出： 无                                                                               
 172          *  备注：                                         
 173          ********************************************************************************************************/
 174          void WriteSystemTime(void)
 175          {
 176   1        //return;
 177   1        RTC_TimeTypeDef Temp_RTC_Time;
*** ERROR C202 IN LINE 177 OF Drivers\Drivers_Src\RealTimeClock.c: 'RTC_TimeTypeDef': undefined identifier
*** ERROR C141 IN LINE 177 OF Drivers\Drivers_Src\RealTimeClock.c: syntax error near 'Temp_RTC_Time', expected ';'
 178   1        RTC_DateTypeDef Temp_RTC_Date;
*** ERROR C202 IN LINE 178 OF Drivers\Drivers_Src\RealTimeClock.c: 'RTC_DateTypeDef': undefined identifier
*** ERROR C141 IN LINE 178 OF Drivers\Drivers_Src\RealTimeClock.c: syntax error near 'Temp_RTC_Date', expected ';'
 179   1        
 180   1        Temp_RTC_Time.Hours = SystemTime.hour;
 181   1        Temp_RTC_Time.Minutes = SystemTime.minute;  
 182   1        Temp_RTC_Time.Seconds = SystemTime.second;  
 183   1        Temp_RTC_Time.TimeFormat = RTC_HOURFORMAT12_AM; 
 184   1        Temp_RTC_Time.SubSeconds = 0;
 185   1        Temp_RTC_Time.SecondFraction = 0;
 186   1        Temp_RTC_Time.DayLightSaving = RTC_DAYLIGHTSAVING_NONE;
 187   1        Temp_RTC_Time.StoreOperation = RTC_STOREOPERATION_RESET ;
 188   1        
 189   1        Temp_RTC_Date.Date = SystemTime.date; 
 190   1        Temp_RTC_Date.WeekDay = SystemTime.day; 
 191   1        Temp_RTC_Date.Month = SystemTime.month;     
 192   1        Temp_RTC_Date.Year = SystemTime.year; 
 193   1        
 194   1        HAL_RTC_SetDate(&hrtc,&Temp_RTC_Date,RTC_FORMAT_BCD);
*** ERROR C202 IN LINE 194 OF Drivers\Drivers_Src\RealTimeClock.c: 'hrtc': undefined identifier
 195   1        HAL_RTC_SetTime(&hrtc,&Temp_RTC_Time,RTC_FORMAT_BCD);
*** ERROR C202 IN LINE 195 OF Drivers\Drivers_Src\RealTimeClock.c: 'hrtc': undefined identifier
 196   1      }
 197          /*************************************************************************************************          
             -                                                     
 198          *  Object:       
 199          *  输入： 无
 200          *  输出： 无                                                                               
 201          *  备注：                                         
 202          ********************************************************************************************************/
 203          void SystemTimeUpdate(void)
 204          {
 205   1        ReadSystemTime();
 206   1      } 
 207          
 208          /*************************************************************************************************          
             -                                                     
 209          *  Object:       
 210          *  输入： 无
 211          *  输出： 无                                                                               
 212          *  备注：                                         
 213          ********************************************************************************************************/
 214          void EnableRTCWakeup(void)
 215          {
 216   1      
 217   1      }
 218          
 219          /*************************************************************************************************          
             -                                                     
 220          *  Object:       
C51 COMPILER V9.60.0.0   REALTIMECLOCK                                                     09/13/2022 09:51:41 PAGE 5   

 221          *  输入： 无
 222          *  输出： 无                                                                               
 223          *  备注：                                         
 224          ********************************************************************************************************/
 225          void DisableRTCWakeup(void)
 226          {
 227   1      
 228   1      }
 229          #endif
 230          
 231          

C51 COMPILATION COMPLETE.  0 WARNING(S),  13 ERROR(S)
