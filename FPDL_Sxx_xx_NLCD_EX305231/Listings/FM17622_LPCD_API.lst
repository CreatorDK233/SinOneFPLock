C51 COMPILER V9.60.0.0   FM17622_LPCD_API                                                  05/23/2023 14:43:18 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE FM17622_LPCD_API
OBJECT MODULE PLACED IN .\Objects\FM17622_LPCD_API.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE Drivers\Protocol\FM17622_LPCD_API.c LARGE OMF2 OPTIMIZE(9,SPEED) BROWSE 
                    -INCDIR(.\Drivers\Lib\c;.\Drivers\Lib\H;.\Drivers\Lib\IAP_Lib;.\Drivers\Lib\TouchKey_lib;.\Drivers\Physical;.\Drivers\Pro
                    -tocol;.\Softwares\Application;.\Softwares\Basic;.\Softwares\ModuleLogic;.\Drivers\Protocol\YC_NFC;.\Drivers\Protocol\WIF
                    -I_Tuya) DEBUG PRINT(.\Listings\FM17622_LPCD_API.lst) TABS(2) OBJECT(.\Objects\FM17622_LPCD_API.obj)

line level    source

   1          /*********************************************************************
   2          *                                                                    *
   3          *   Copyright (c) 2010 Shanghai FuDan MicroElectronic Inc, Ltd.      *
   4          *   All rights reserved. Licensed Software Material.                 *
   5          *                                                                    *
   6          *   Unauthorized use, duplication, or distribution is strictly       *
   7          *   prohibited by law.                                               *
   8          *                                                                    *
   9          *********************************************************************/
  10          
  11          /********************************************************************/
  12          /*  FM17622 LPCD API 函数库V01(FM17610可以完全兼容)                 */
  13          /*  主要功能:                                                       */
  14          /*      实现17622芯片内部ADC_LPCD功能，主要包含两个函数             */
  15          /*      (1)Lpcd_Init_Register()函数，进行LPCD功能参数配置           */
  16          /*      (2)Lpcd_IRQ_Event()函数，处理LPCD中断事件                   */
  17          /*  编制:宋耀海                                                     */
  18          /*  编制时间:2021年10月28日                                         */
  19          /*                                                                  */
  20          /********************************************************************/
  21          #include "FM17622_LPCD_API.h"
  22          #include "MFC_MF17622.h"
  23          #include "StdTypes.h"
  24          #include "Project.h"
  25          //***********************************************
  26          //函数名称：GetReg_Ext(unsigned char ExtRegAddr,unsigned char* ExtRegData)
  27          //函数功能：读取扩展寄存器值
  28          //入口参数：ExtRegAddr:扩展寄存器地址   ExtRegData:读取的值
  29          //出口参数：unsigned char  TRUE：读取成功   FALSE:失败
  30          //***********************************************
  31          void GetReg_Ext(unsigned char ExtRegAddr,unsigned char* ExtRegData)
  32          {
  33   1        uint8_t tempdata;
  34   1        WriteRawRC(JREG_EXT_REG_ENTRANCE,JBIT_EXT_REG_RD_ADDR + ExtRegAddr);
  35   1        tempdata = ReadRawRC(JREG_EXT_REG_ENTRANCE);
  36   1        *ExtRegData = tempdata;
  37   1      }
  38          
  39          //***********************************************
  40          //函数名称：SetReg_Ext(unsigned char ExtRegAddr,unsigned char* ExtRegData)
  41          //函数功能：写扩展寄存器
  42          //入口参数：ExtRegAddr:扩展寄存器地址   ExtRegData:要写入的值
  43          //出口参数：unsigned char  TRUE：写成功   FALSE:写失败
  44          //***********************************************
  45          void SetReg_Ext(unsigned char ExtRegAddr,unsigned char ExtRegData)
  46          {
  47   1        WriteRawRC(JREG_EXT_REG_ENTRANCE,JBIT_EXT_REG_WR_ADDR + ExtRegAddr);
  48   1        WriteRawRC(JREG_EXT_REG_ENTRANCE,JBIT_EXT_REG_WR_DATA + ExtRegData);
  49   1      }
  50          //***********************************************
  51          //函数名称：Lpcd_Init_Register()
  52          //函数功能：LPCD寄存器初始化配置
C51 COMPILER V9.60.0.0   FM17622_LPCD_API                                                  05/23/2023 14:43:18 PAGE 2   

  53          //入口参数：
  54          //出口参数：SUCCESS：配置完成 
  55          //***********************************************
  56          status_t Lpcd_Init_Register(void)
  57          {
  58   1        uint8_t TryTimes=3;
  59   1      
  60   1        do 
  61   1        {
  62   2          if(FM17622_SoftReset() == S_SUCCESS)
  63   2          {
  64   3            SetReg_Ext(0x24, 0x14);//请勿修改
  65   3            SetReg_Ext(0x25, 0x3A);//请勿修改
  66   3            SetReg_Ext(JREG_LPCDCTRLMODE, (RF_DET_ENABLE|RF_DET_SEN_00|LPCD_ENABLE));//
  67   3            //SetReg_Ext(JREG_LPCDDETECTMODE, LPCD_TXSCALE_4|LPCD_RX_CHANGE_MODE);
  68   3      
  69   3            SetReg_Ext(JREG_LPCDSLEEPTIMER, LPCD_SLEEPTIME);
  70   3            SetReg_Ext(JREG_LPCDRFTIMER, LPCD_IRQINV_ENABLE|LPCD_IRQ_PUSHPULL|LPCD_RFTIME_5us);//探测时间配置使用5u
             -s
  71   3            SetReg_Ext(JREG_LPCDTHRESH_L, LPCD_THRSH_L);
  72   3            SetReg_Ext(JREG_LPCDTXCTRL2, LPCD_CWP);
  73   3            SetReg_Ext(JREG_LPCDTXCTRL3, LPCD_CWN);
  74   3            
  75   3            SetReg_Ext(JREG_LPCDREQATIMER,LPCD_REQA_TIME_5ms);//REQA操作时间,5ms兼容手机方案
  76   3            
  77   3            SetReg_Ext(JREG_LPCDREQAANA,LPCD_RXGAIN_33DB | LPCD_MINLEVEL_9 | LPCD_MODWIDTH_38);
  78   3            SetReg_Ext(JREG_LPCDDETECTMODE,LPCD_TXSCALE_4|LPCD_COMBINE_MODE);//配置REQA检测功能
  79   3            break;
  80   3          }
  81   2          TryTimes--;
  82   2          DEBUG_MARK;
  83   2        }while (TryTimes>0);
  84   1      
  85   1        if ( TryTimes == 0)
  86   1        {
  87   2          return S_FAIL;
  88   2        }
  89   1        else
  90   1        {
  91   2          return S_SUCCESS;
  92   2        }
  93   1      }
  94          
  95          //***********************************************
  96          //函数名称：Lpcd_Get_ADC_Value()
  97          //函数功能：Lpcd_Get_ADC_Value读取LPCD的ADC数据
  98          //入口参数：
  99          //出口参数：
 100          //***********************************************
 101          void Lpcd_Get_ADC_Value(void)
 102          {
 103   1        unsigned char reg,reg1;
 104   1        unsigned char lpcd_delta1,lpcd_delta2;
 105   1        {
 106   2          GetReg_Ext(JREG_LPCDDELTA_HI, &reg);
 107   2          GetReg_Ext(JREG_LPCDDELTA_LO, &reg1);
 108   2          lpcd_delta1 = (reg<<6) + reg1;
 109   2          lpcd_delta2 = ((reg<<6)>>8);
 110   2        } 
 111   1        return; 
 112   1      }
 113          
C51 COMPILER V9.60.0.0   FM17622_LPCD_API                                                  05/23/2023 14:43:18 PAGE 3   

 114          void Lpcd_ClearIrq(void)
 115          {
 116   1        unsigned char reg;
 117   1        GetReg_Ext(JREG_LPCDIRQ, &reg);//读取LPCD中断标志
 118   1        SetReg_Ext(JREG_LPCDIRQ, reg);//CLEAR LPCD IRQ
 119   1      }
 120          //***********************************************
 121          //函数名称：Lpcd_IRQ_Event()
 122          //函数功能：LPCD中断处理
 123          //入口参数：
 124          //出口参数：
 125          //***********************************************
 126          void Lpcd_IRQ_Event(void)
 127          {
 128   1        //unsigned char reg;
 129   1        
 130   1      //    Lpcd_Set_Mode(FM17622_LPCD_DISABLE);    //NPD = 1,FM17622退出休眠模式 
 131   1      //    
 132   1      //    GetReg_Ext(JREG_LPCDIRQ, &reg);//读取LPCD中断标志
 133   1      //    SetReg_Ext(JREG_LPCDIRQ, reg);//CLEAR LPCD IRQ
 134   1      //  
 135   1      //    if(reg & 0x08) 
 136   1      //    {
 137   1      //    }
 138   1      //    if(reg & 0x04)
 139   1      //    {
 140   1      //      Lpcd_Get_ADC_Value();//用于LPCD功能调试         
 141   1      //    }
 142   1      //    if(reg & 0x02)
 143   1      //    {
 144   1      //    }
 145   1      //    
 146   1      //    if((reg & 0x08) ||(reg & 0x04)||(reg & 0x02))
 147   1      //    {
 148   1      //      Lpcd_Card_Event();//卡片操作处理流程 
 149   1      
 150   1      //    }
 151   1      //    
 152   1      //    Lpcd_Init_Register();//LPCD初始化  
 153   1      //    Lpcd_Set_Mode(FM17622_LPCD_ENABLE);//返回LPCD模式 
 154   1        return; 
 155   1      }
 156          
 157          
 158          unsigned char Lpcd_Card_Event(void)
 159          {
 160   1        unsigned char result;
 161   1        return result;
 162   1      }
 163          
 164          
 165          
 166          
 167          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    271    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----      11
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
C51 COMPILER V9.60.0.0   FM17622_LPCD_API                                                  05/23/2023 14:43:18 PAGE 4   

   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
